# Lombok Build Error Fix

## Problem
All four microservices (order-service, payment-service, restaurant-service, notification-service) are failing to compile because Lombok annotations are not being processed by the Maven compiler. This results in missing:
- `builder()` methods
- Getter/setter methods
- `log` variables (from `@Slf4j`)

## Root Cause
The Maven compiler plugin is not configured to process Lombok annotations during compilation.

## Solution

Apply these fixes to **each service's pom.xml** file:

### 1. Ensure Lombok Dependency is Present

Add or verify this dependency exists in the `<dependencies>` section:

```xml
<dependencies>
    <!-- Lombok -->
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <version>1.18.30</version>
        <scope>provided</scope>
    </dependency>

    <!-- Other dependencies... -->
</dependencies>
```

### 2. Configure Maven Compiler Plugin

Add or update the maven-compiler-plugin in the `<build><plugins>` section:

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-compiler-plugin</artifactId>
            <version>3.11.0</version>
            <configuration>
                <source>17</source>
                <target>17</target>
                <annotationProcessorPaths>
                    <path>
                        <groupId>org.projectlombok</groupId>
                        <artifactId>lombok</artifactId>
                        <version>1.18.30</version>
                    </path>
                </annotationProcessorPaths>
            </configuration>
        </plugin>
    </plugins>
</build>
```

### 3. Alternative: Use Spring Boot Parent POM (Recommended)

If using Spring Boot, ensure your services inherit from spring-boot-starter-parent:

```xml
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>3.1.5</version>
    <relativePath/>
</parent>
```

The Spring Boot parent POM automatically configures Lombok properly. You only need the Lombok dependency (step 1).

### 4. Clean and Rebuild

After making these changes, clean and rebuild each service:

```bash
# For each service directory
cd services/order-service
mvn clean install

cd ../payment-service
mvn clean install

cd ../restaurant-service
mvn clean install

cd ../notification-service
mvn clean install
```

## Files to Fix

Apply the above configuration to these files:
1. `services/order-service/pom.xml`
2. `services/payment-service/pom.xml`
3. `services/restaurant-service/pom.xml`
4. `services/notification-service/pom.xml`

## Verification

After applying the fixes, you should see:
- No "cannot find symbol" errors for `builder()`, getters, setters
- No "cannot find symbol" errors for `log` variable
- Successful compilation: `BUILD SUCCESS`

## Additional Issues Found

### 1. Order Service - OrderItem method reference issue
**File**: `services/order-service/src/main/java/com/cookedspecially/orderservice/domain/Order.java:110`

The error suggests an invalid method reference `OrderItem::getQuantity`. This might be because:
- The method doesn't exist (should be generated by Lombok)
- The generic type parameter is incorrect

Ensure `OrderItem` class has `@Data` or `@Getter` annotation.

### 2. Notification Service - AWS SES SendQuota class
**File**: `services/notification-service/src/main/java/com/cookedspecially/notificationservice/service/EmailService.java:202`

Missing import or wrong AWS SDK version. The `SendQuota` class should be imported from:
```java
import software.amazon.awssdk.services.ses.model.SendQuota;
```

Ensure you're using AWS SDK v2:
```xml
<dependency>
    <groupId>software.amazon.awssdk</groupId>
    <artifactId>ses</artifactId>
    <version>2.20.143</version>
</dependency>
```

### 3. Notification Service - ErrorResponse.FieldError constructor
**File**: `services/notification-service/src/main/java/com/cookedspecially/notificationservice/controller/GlobalExceptionHandler.java:122`

The FieldError constructor is being called incorrectly. Change from:
```java
new FieldError(field, error.getDefaultMessage())
```

To use a builder or factory method:
```java
ErrorResponse.FieldError.builder()
    .field(field)
    .message(error.getDefaultMessage())
    .build()
```

Or if FieldError is a simple record/class, add proper constructor or use setters.

## Quick Fix Script

Create a script `fix-lombok.sh` in the project root:

```bash
#!/bin/bash

SERVICES="order-service payment-service restaurant-service notification-service"

for service in $SERVICES; do
    echo "Cleaning $service..."
    cd services/$service
    mvn clean
    cd ../..
done

echo "All services cleaned. Now update the pom.xml files as documented, then run:"
echo "  mvn clean install -DskipTests"
```

## If Issues Persist

1. **Clear local Maven repository cache**:
   ```bash
   rm -rf ~/.m2/repository/org/projectlombok
   mvn dependency:resolve
   ```

2. **Verify Lombok version compatibility** with Java 17:
   - Use Lombok 1.18.24 or newer for Java 17
   - Check: https://projectlombok.org/changelog

3. **IDE-specific issues**:
   - IntelliJ: Install Lombok plugin and enable annotation processing
   - Eclipse: Install Lombok via `java -jar lombok.jar`
   - VS Code: Install "Lombok Annotations Support" extension

4. **Check for conflicting annotation processors**:
   - Remove any other annotation processors that might conflict
   - Ensure only Lombok is in the `annotationProcessorPaths`

## Expected Outcome

After applying all fixes:
- ✅ All 4 services compile successfully
- ✅ No Lombok-related errors
- ✅ `mvn clean package -DskipTests` completes with BUILD SUCCESS
- ✅ Generated getter/setter methods available
- ✅ Builder pattern works
- ✅ Logging (log variable) available

## Next Steps

Once builds are successful:
1. Run with tests: `mvn clean verify`
2. Check for any remaining runtime issues
3. Commit the pom.xml changes
4. Update CI/CD pipeline to use correct Maven goals
