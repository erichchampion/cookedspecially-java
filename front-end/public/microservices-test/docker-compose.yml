# Docker Compose for CookedSpecially Microservices Testing
# This file helps run all services and the testing dashboard together

version: '3.8'

services:
  # Frontend Testing Dashboard
  testing-dashboard:
    image: nginx:alpine
    container_name: cookedspecially-testing-dashboard
    ports:
      - "8000:80"
    volumes:
      - ./:/usr/share/nginx/html:ro
    networks:
      - cookedspecially-network
    depends_on:
      - restaurant-service
      - order-service
      - customer-service
      - admin-service
      - payment-service
      - loyalty-service
      - kitchen-service
      - reporting-service
      - integration-service
      - notification-service

  # Restaurant Service
  restaurant-service:
    build: ../../../services/restaurant-service
    container_name: restaurant-service
    ports:
      - "8081:8081"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - DB_HOST=postgres
      - REDIS_HOST=redis
    networks:
      - cookedspecially-network
    depends_on:
      - postgres
      - redis

  # Order Service
  order-service:
    build: ../../../services/order-service
    container_name: order-service
    ports:
      - "8082:8082"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - DB_HOST=postgres
      - REDIS_HOST=redis
    networks:
      - cookedspecially-network
    depends_on:
      - postgres
      - redis

  # Payment Service
  payment-service:
    build: ../../../services/payment-service
    container_name: payment-service
    ports:
      - "8083:8083"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - DB_HOST=postgres
      - REDIS_HOST=redis
    networks:
      - cookedspecially-network
    depends_on:
      - postgres
      - redis

  # Customer Service
  customer-service:
    build: ../../../services/customer-service
    container_name: customer-service
    ports:
      - "8084:8084"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - DB_HOST=postgres
      - REDIS_HOST=redis
    networks:
      - cookedspecially-network
    depends_on:
      - postgres
      - redis

  # Notification Service
  notification-service:
    build: ../../../services/notification-service
    container_name: notification-service
    ports:
      - "8085:8085"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - DB_HOST=postgres
      - REDIS_HOST=redis
    networks:
      - cookedspecially-network
    depends_on:
      - postgres
      - redis

  # Loyalty Service
  loyalty-service:
    build: ../../../services/loyalty-service
    container_name: loyalty-service
    ports:
      - "8086:8086"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - DB_HOST=postgres
      - REDIS_HOST=redis
    networks:
      - cookedspecially-network
    depends_on:
      - postgres
      - redis

  # Kitchen Service
  kitchen-service:
    build: ../../../services/kitchen-service
    container_name: kitchen-service
    ports:
      - "8087:8087"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - DB_HOST=postgres
      - REDIS_HOST=redis
    networks:
      - cookedspecially-network
    depends_on:
      - postgres
      - redis

  # Reporting Service
  reporting-service:
    build: ../../../services/reporting-service
    container_name: reporting-service
    ports:
      - "8088:8088"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - DB_HOST=postgres
      - REDIS_HOST=redis
    networks:
      - cookedspecially-network
    depends_on:
      - postgres
      - redis

  # Integration Hub Service
  integration-service:
    build: ../../../services/integration-hub-service
    container_name: integration-service
    ports:
      - "8089:8089"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - DB_HOST=postgres
      - REDIS_HOST=redis
    networks:
      - cookedspecially-network
    depends_on:
      - postgres
      - redis

  # Admin Service
  admin-service:
    build: ../../../services/admin-service
    container_name: admin-service
    ports:
      - "8090:8090"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - DB_HOST=postgres
      - REDIS_HOST=redis
    networks:
      - cookedspecially-network
    depends_on:
      - postgres
      - redis

  # PostgreSQL Database
  postgres:
    image: postgres:15-alpine
    container_name: cookedspecially-postgres
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_USER=cookedspecially
      - POSTGRES_PASSWORD=cookedspecially
      - POSTGRES_DB=cookedspecially
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - cookedspecially-network

  # Redis Cache
  redis:
    image: redis:7-alpine
    container_name: cookedspecially-redis
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
    networks:
      - cookedspecially-network

networks:
  cookedspecially-network:
    driver: bridge

volumes:
  postgres-data:
  redis-data:
