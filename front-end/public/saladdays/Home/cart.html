<!DOCTYPE html>
<html lang="en" xmlns:fb="https://ogp.me/ns/fb#">
<head prefix="og: https://ogp.me/ns# fb: //ogp.me/ns/fb# business: http://ogp.me/ns/business#">
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<meta name="description" content="At Salad Days, we serve our customers healthy, organic and delicious fruit salad, veg salads, legume salads and chicken salad. Our salads are made fresh and delivered at your doorstep.">
	<meta http-equiv="X-UA-Compatible" content="IE=EDGE"/>
	<meta charset="utf-8"/>
	<meta id="og_title" property="og:title" content="Salad Days - Handcrafted Premium Salads"/>
	<meta id="og_image" property="og:image" content="https://static.squarespace.com/static/52dae045e4b050691872aeee/52dc34fce4b0845775fa4f80/53093ad3e4b0dd985a43dfc4/1393113819369/Veggie.jpg?format=1000w"/>
	<meta property="og:description" content="At Salad Days, we serve our customers healthy, organic and delicious fruit salad, veg salads, legume salads and chicken salad. Our salads are made fresh and delivered at your doorstep.">
	<meta property="og:site_name" content="Salad Days">
	<meta property="fb:app_id"                            content="226697114202871"/>
	<meta property="og:type"                              content="restaurant.restaurant"/>
	<meta property="business:contact_data:street_address" content="U 60/37 Dlf city phase 3"/>
	<meta property="business:contact_data:locality"       content="Gurgaon, Haryana"/>
	<meta property="business:contact_data:postal_code"    content="122002"/>
	<meta property="business:contact_data:country_name"   content="India"/>
	<meta property="place:location:latitude"              content="28.4700"/>
	<meta property="place:location:longitude"             content="77.0300"/>

	<meta itemprop="name" content="Salad Days Menu - Fruit Salad, Veggie Salad, Legume Salad and Chicken Salad - Healthy Organic Food">
	<meta content="Delivering handcrafted premium salads in Gurgaon. Our salad meals are healthy, nutritious and made fresh using the best homegrown ingredients." name="description">
	<meta itemprop="url" content="//www.saladdays.co/">
	<meta itemprop="description" content="We deliver handcrafted premium salads in Gurgaon. Enjoy real salads served
as meals!">
	<meta itemprop="image" content="saladdays.co/images/home/logo.jpg">
	<meta itemprop="thumbnailUrl" content="saladdays.co/images/home/logo.jpg">

	<meta name="twitter:image" content="saladdays.co/images/home/logo.jpg">
	<meta name="twitter:title" content="Salad Days - Handcrafted Premium Salads">
	<meta name="twitter:url" content="//www.saladdays.co/">
	<meta name="twitter:card" content="summary">
	<meta name="twitter:description" content="At Salad Days, we serve our customers healthy, organic and delicious fruit salad, veg salads, legume salads and chicken salad. Our salads are made fresh and delivered at your doorstep.">

	<meta name="msvalidate.01" content="7C7FC8D9471A62E4688716400DC51F02">
	<meta name="google-site-verification" content="AsZ8ONSJ-ZL07RO5uUtlZhJB2tk_Ei7euSCbST9yNfE">
	<meta name="alexaVerifyID" content="S647rjQV_7zkWmgNSIg6-j1dckY">

	<title>Cart | Saladdays</title>
	<link href="css/bootstrap.min.css" rel="stylesheet"/>
	<link href="css/font-awesome.min.css" rel="stylesheet"/>
	<link href="css/animate.css" rel="stylesheet"/>
	<link href="css/main.css" rel="stylesheet"/>
	<link href="css/responsive.css" rel="stylesheet"/>
	<link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">
	<!--[if lt IE 9]>
	<script src="js/html5shiv.js"></script>
	<script src="js/respond.min.js"></script>
	<![endif]-->
	<link rel="shortcut icon" href="images/ico/favicon.ico"/>
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="images/ico/apple-touch-icon-144-precomposed.png"/>
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/ico/apple-touch-icon-114-precomposed.png"/>
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="images/ico/apple-touch-icon-72-precomposed.png"/>
	<link rel="apple-touch-icon-precomposed" href="images/ico/apple-touch-icon-57-precomposed.png"/>
	<script src="js/jquery.js"></script>
	<script src="//connect.facebook.net/en_US/all.js" async></script>
	<script src="js/facebook.js" async></script>
	
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.scrollUp.min.js"></script>
<script src="js/jquery.prettyPhoto.js"></script>
	<style>
	/* Smartphones (portrait and landscape) ----------- */
@media only screen 
and (min-device-width : 320px) 
and (max-device-width : 480px) {
/* Styles */
}

/* Smartphones (landscape) ----------- */
@media only screen 
and (min-width : 321px) {
.modal-dialog {
    width: 240px;
    margin: 30px auto;
}
}

/* Smartphones (portrait) ----------- */
@media only screen 
and (max-width : 320px) {
.modal-dialog {
    width: 240px;
    margin: 30px auto;
}
}

/* iPads (portrait and landscape) ----------- */
@media only screen 
and (min-device-width : 768px) 
and (max-device-width : 1024px) {
.modal-dialog {
    width: 240px;
    margin: 30px auto;
}
}

/* iPads (landscape) ----------- */
@media only screen 
and (min-device-width : 768px) 
and (max-device-width : 1024px) 
and (orientation : landscape) {
.modal-dialog {
    width: 240px;
    margin: 30px auto;
}
}

/* iPads (portrait) ----------- */
@media only screen 
and (min-device-width : 768px) 
and (max-device-width : 1024px) 
and (orientation : portrait) {
.modal-dialog {
    width: 240px;
    margin: 30px auto;
}
}

/* Desktops and laptops ----------- */
@media only screen 
and (min-width : 1224px) {
.modal-dialog {
    width: 240px;
    margin: 30px auto;
}
}

/* Large screens ----------- */
@media only screen 
and (min-width : 1824px) {
.modal-dialog {
    width: 240px;
    margin: 30px auto;
}
}

/* iPhone 4 ----------- */
@media only screen
and (-webkit-min-device-pixel-ratio : 1.5),
and (min-device-pixel-ratio : 1.5) {
.modal-dialog {
    width: 240px;
    margin: 30px auto;
}
}
	</style>
	
	<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','//connect.facebook.net/en_US/fbevents.js');

fbq('init', '696084253783864');
fbq('track', 'AddPaymentInfo');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=696084253783864&ev=PageView&noscript=1"
/></noscript>
<!-- End Facebook Pixel Code -->
<!--  Start kissMetrics -->
<script type="text/javascript">var _kmq = _kmq || []; var _kmk = _kmk || 'e3c0b2dd00c10e4b5aa90c6b707fb373b6b13883'; function _kms(u){ setTimeout(function(){ var d = document, f = d.getElementsByTagName('script')[0], s = d.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = u; f.parentNode.insertBefore(s, f); }, 1); } _kms('//i.kissmetrics.com/i.js'); _kms('//scripts.kissmetrics.com/' + _kmk + '.2.js'); </script>
<!--  End kissMetrics -->
</head><!--/head-->

<body>
<div class="logo">
	<a href="index.html">
	<img id="logo-image" src="images/home/logo.jpg" alt="SALAD DAYS"/>
	</a>
</div>
<nav class="mobile-nav">
	<ul class="menu">
		<li><a href="index.html">HOME</a></li>
		<li><a href="menu.html">ORDER NOW</a></li>
    <li><a href="me_menu.html">MORNING EXPRESS</a></li>


		<li><a href="wow.html">MORE</a>
			<ul>
				<li><a href="services.html">SERVICES</a></li>
				<li><a href="wow.html">WOW</a>
				<li><a href="story.html">STORY</a></li>
			<!-- 	<li><a href="blog.html">BLOG</a></li> -->
				<li><a href="contact-us.html">CONTACT US</a></li>
			</ul>
		</li>
		<li><a class="keepShoppingLink" onclick="backToMenu()"><i style="color: red" class="fa fa-mail-reply"></i>&nbsp;&nbsp;KEEP SHOPPING</a></li>
		<li><a class="logout" onclick="logout()">LOG OUT</a></li>
	</ul>
</nav>
<nav id="navigation-bar" class="navbar navbar-default">
	<div class="container-fluid">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button id="mobile-nav" type="button" class="navbar-toggle collapsed">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<img id="title-mobile" src="images/title.png"/>
			<!-- <a href=""><i class="fa fa-phone"></i> +91 9643 800 901/02/03</a>
              <a href=""><i class="fa fa-envelope"></i> hello@saladdays.co</a> -->
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav" id="nav-bar">
				<!-- <li class="active"><a href="#">Link <span class="sr-only">(current)</span></a></li> -->
				 <li><a href="index.html">HOME</a></li>

				<li><a href="menu.html">ORDER NOW</a></li>
				<li><a href="me_menu.html">MORNING EXPRESS</a></li>


				<li><a href="wow.html" class="dropdown">MORE</a>
          <ul class="dropdown-menu" style="min-width:115px" >
            <li class="moreLi"><a href="services.html">SERVICES</a></li>
            <li class="moreLi"><a href="wow.html">WOW</a>
            <li class="moreLi"><a href="story.html">STORY</a></li>
           <!--  <li class="moreLi"><a href="blog.html">BLOG</a></li> -->
            <li class="moreLi"><a href="contact-us.html">CONTACT US</a></li>
          </ul>
        </li>
				<li><a class="keepShoppingLink" onclick="backToMenu()"><i style="color: red" class="fa fa-mail-reply"></i>&nbsp;&nbsp;KEEP SHOPPING</a></li>
				<li><a class="logout" onclick="logout()">LOG OUT</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</div><!-- /.container-fluid -->
</nav>
<div class="container">
	<div id="check" style="height: 100%; width: 100%; display: none">
	</div>
	<div class="col-sm-7" id="cart-items">
		<div class="table-responsive cart_info">
			<p id="orderSummaryTitle" class="order-summary">Order Summary</p>
			<table id="vatRow" class="table table-condensed">
				<thead>
				<tr class="cart_menu">
					<td class="cart_product"></td>
					<td class="cart_description">Item</td>
					<td class="cart_price">Price</td>
					<td class="cart_quantity">Qty.</td>
					<td class="cart_total">Total</td>
					<td class="cart_product"></td>
				</tr>
				</thead>
				<tbody id="cart-items-table-body" style="border-top:0px !important; border-bottom:0px ! important">
				<tr class="total-rows" id="subTotal">
					<td class="cart_product"></td>
					<td class="cart_description"><p style="margin-top: 30px !important;">Sub Total</p></td>
					<td class="cart_price"></td>
					<td class="cart_quantity"></td>
					<td class="cart_total" id="subtotal-amount"></td>
				</tr>
				<tbody style="border-bottom:0px ! important" id="taxBody">
				</tbody >
				 <!-- <tr class="total-rows" id="vatRow">
					<td class="cart_product"></td>
					<td class="cart_description"><p id="vatName"></p></td>
					<td class="cart_price"></td>
					<td class="cart_quantity"></td>
					<td class="cart_total" id="VAT"></td>
				</tr> -->
				<tbody style="border-top:0px !important;">
				<tr class="total-rows" >
					<td class="cart_product"></td>
					<td class="cart_description"><p>Delivery Charges <span id="serviceTaxValue"></span></p></td>
					<td class="cart_price"></td>
					<td class="cart_quantity"></td>
					<td class="cart_total" id="delivery-amount"></td>
				</tr>
				</tbody>
				<tr class="total-rows">
				<td class="cart_product"></td>
				<td class="cart_description"><p>Total</p></td>
				<td class="cart_price"></td>
				<td class="cart_quantity"></td>
				<td class="cart_total" id="total-amount"></td>
				</tr>
				<tr id="creditRow" class="total-rows">
				<td class="cart_product"></td>
				<td class="cart_description"><p>Credit Balance</p></td>
				<td class="cart_price"></td>
				<td class="cart_quantity"></td>
				<td class="cart_total" ><span id="credit-amount"></span></td>
				</tr>
				<tbody>
				<tr id="totalWithCreditRow" class="total-rows">
				<td class="cart_product"></td>
				<td class="cart_description"><p>Amount Payable </p></td>
				<td class="cart_price"></td>
				<td class="cart_quantity"></td>
				<td class="cart_total" ><span id="credt_total_amount"></span></td>
				</tr>
				</tbody>
				</tbody>
			</table>
		</div>
	</div>
	<div class="col-sm-5" id="user-details">
		<p id="cartTitle">Morning Express</p>
		<div class="phone-number" id="sign-in-div">
			<p class="form-labels">Mobile Number<sup> *</sup></p>
			<form>
			<select style="width:15%" id="countryCode">
			<option value="+91">+91</option>
			</select>
		    <input type="text" id="customerPhone" style="width:84%;height:30px;" placeholder="Mobile Number">
			<button class="btn btn-primary" type="submit" id="phone-number-button" href="">Continue</button>
			</form>
			<div align="center">OR</div>
			<button class="btn btn-primary"   onclick="loginWithFacebook()"  style="background-color:#3A5897"><img src="images/Facebook-New-Logo-2013.png"  style="height:20px;width:20px;margin-right: 10px;" />Login with Facebook</button>
		</div>
		<div class="clearfix" id="auto-fill-details">
			<div class="bill-to">
				<p class="form-labels">Hello,</p>
				<div class="col-sm-12" id="name-and-email-form">
					<input type="text" id="name-field" placeholder="Your Name">
					<input type="text" id="email-field" placeholder="Email">
				</div>
				<p class="form-labels" id="delivery-address-label">Select Delivery Address</p>
				<div class="address-options" id="address-options"></div>
			
				<p class="form-labels" id="delivery-time-label">Select Delivery Time</p>
				<div style="display:none" id="deliveryTimeDiv">
					<select id="select-delivery-day">
						<option value="Deliver Today">Deliver Today</option>
						<option value="Deliver Tomorrow">Deliver Tomorrow</option>
					</select>
					<select id="select-delivery-time">
						<option id="placeholder" data-theme="d" data-placeholder="true" value="- Delivery Time -">- Delivery Time -</option>
					</select>
				</div>
				<div class="payment-options" id="hide_me"  >
				<p class="form-labels" id="payment-options-label">Select Payment Option</p>
				    <label id="optionWithCredit" class="payment-method" ><input  name="payment-method" type="radio" id="optionCustomerCredit" value="CUSTOMER CREDIT" >&nbsp; Customer Credit </label>
					<label class="payment-method" ><input name="payment-method" type="radio" id="optionCOD" value="COD"  >&nbsp; Cash on delivery </label>
				   <label class="payment-method"><input name="payment-method" type="radio" value="Online">&nbsp; Pay Now</label>
					<label class="payment-method"><input name="payment-method" type="radio" value="MobiKwikWallet"><img alt="MobiKwik" src="images/mobikwik.png"></label>
					<label class="payment-method"><input name="payment-method" type="radio" value="payTm"><img alt="PayTm" src="images/Paytm.png"></label>
				
				</div>
				<!-- <div class="payment-options" id="optionWithoutCredit">
					<label class="payment-method" ><input name="payment-method" type="radio" value="COD" checked="checked">&nbsp; Cash on delivery </label>
					<label class="payment-method"><input name="payment-method" type="radio" value="Online">&nbsp; Pay Now</label>
					<label class="payment-method"><input name="payment-method" type="radio" value="Subscription">&nbsp; Subscription</label>
					<label class="payment-method"><input name="payment-method" type="radio" value="MobiKwikWallet"><img alt="MobiKwik" src="images/mobikwik.png"></label>
				</div> -->
				<div class="order-message"><br/>
					<p class="form-labels">Instructions to the chef</p>
					<textarea id="instructions" name="message"  placeholder="Special instructions (note: Additional ingredients may be charged extra)" rows="5"></textarea>
				</div>
			</div>
			<a class="btn btn-primary" id="proceed-button" href="">Place Order</a>
		</div>
	</div>
</div>
<footer id="footer"><!--Footer-->
	<div class="footer-bottom">
		<div class="container">
			<div class="col-sm-8 footer-div">
				<p class="pull-left">Copyright © 2014 Salad Days. All rights reserved.</p>
				<p><a id="privacy-policy-link" target="_blank" href="/resources/Salad+Days+Policy.pdf">Return and Cancellation Policy I &nbsp;Delivery policy I Terms &amp; Conditions </a></p>
			</div>
			<div id="social-media-icons" class="col-sm-4 footer-div">
				<ul>
					<li class="social-media"><a href="https://www.facebook.com/saladdays.co" target="_blank"><i class="fa fa-facebook"></i></a></li>
					<li class="social-media"><a href="https://twitter.com/saladdaysco" target="_blank"><i class="fa fa-twitter"></i></a></li>
					<li class="social-media"><a href="https://instagram.com/saladdaysco/" target="_blank"><i class="fa fa-instagram"></i></a></li>
					<li class="social-media"><a href="https://plus.google.com/+SaladdaysCo" target="_blank"><i class="fa fa-google-plus"></i></a></li>
				</ul>
			</div>
		</div>
	</div>
	</div>
	
</footer><!--/Footer-->
 <!-- Modal -->
 <div class="modal fade" id="mobileNoModal" role="dialog">
    <div class="modal-dialog modal-sm" >
      <div class="modal-content">
        <div class="modal-header" style="padding:10px!important;border:0px!important">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title" style="text-align:center">SALAD DAYS</h4>
        </div>
        <div class="modal-body" style="text-align:center;padding:5px 20px 0px 20px">
          <input type="textbox" class="form-control" id="txtMobileNo" placeholder="Enter Mobile Number"    />
          <label id=lblMobileNoError style="color:red ;font-size:12px;font-weight:normal;padding-top:5px"></label>
        </div>
        <div class="modal-footer" style="text-align:center;padding: 0px 20px 20px!important;border:0px!important;margin-top:0px">
          <button type="button" class="btn btn-default" onclick="submitMobileNumber()">Submit</button>
        </div>
      </div>
    </div>
  </div>
   <div class="modal fade" id="otpModal" role="dialog">
    <div class="modal-dialog modal-sm" >
      <div class="modal-content">
        <div class="modal-header" style="padding:10px!important;border:0px!important">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title" style="text-align:center">SALAD DAYS</h4>
        </div>
        <div class="modal-body" style="text-align:center;padding:5px 20px 0px 20px">
          <input type="textbox" class="form-control" id="txtOTP" placeholder="Enter OTP"   />
          <label style="color:black ;font-size:12px;font-weight:normal;padding-top:5px">OTP not applicable for international and landline numbers.<label style="color:black ;font-size:12px;font-weight:normal;"> Kindly,login using FB.</label></label>
           <label id=lblOTPError style="color:red ;font-size:12px;font-weight:normal;padding-top:5px"></label>
        </div>
        <div class="modal-footer" style="text-align:center;padding: 0px 20px 20px!important;border:0px!important;margin-top:0px">
          <button type="button" class="btn btn-default" onclick="submitOTP()">Submit</button>
          <button type="button" class="btn btn-default" onclick="fetchNewOTP()">Re-send</button>
        </div>
      </div>
    </div>
  </div>
  
<div id="loadingDiv">
	<img id="spinner" src="images/loader/369(4).GIF" style="position: fixed; left: 50%; margin-left: -16px; margin-top: -16px; top: 50%; width: 32px; height: 32px;">
</div>
<script src="js/animate-logo.js"></script>
<script src="js/centerNavBar.js"></script>
<script>

	(function(){
		var reload = false;
		var reloadTag = localStorage.getItem('SD_lastCacheDatetime');
		if(!reloadTag){
			localStorage.setItem('SD_lastCacheDatetime', Date.now());
			reload = true;
		}
		if(reload){
			location.reload(true);
		}
	})();

	var $loading = $('#loadingDiv').hide();
	$(document).ajaxStart(function () {
		$loading.show();
	}).ajaxStop(function () {
		$loading.hide();
	});

	var restaurantId = getURLParameter("restaurantId");
	var sections = [];

	var apiPrefix = "https://www.cookedspecially.com/CookedSpecially";
	//var apiPrefix = "http://localhost:8081/CookedSpecially";
	var getRestaurantInfo = apiPrefix + "/restaurant/getrestaurantinfo?restaurantId=" + restaurantId;
	var _custInfo = '/customer/getCustomerInfo.json?restaurantId=' + restaurantId;
	var _emailCheck = apiPrefix + '/order/emailTemplatedCheck?templateName=saladdaysemailbill';
	var _payOnline = apiPrefix + '/restaurant/redirectToCitrus?';
	var _payByWallet = apiPrefix + '/restaurant/redirectToMobiKwik?';
	var _payBypayTm =  apiPrefix + '/restaurant/redirectToPayTm?';
	var phoneMatch = /^(\+[\d]{1,3}|0)?[7-9]\d{9}$/;
	var phoneClean = /[.-]/g;
	var custIdParam = "";
	var chooseDeliveryAreaPrompt = '- Delivery Area -';
	var chooseDeliveryTimePrompt = "- Delivery Time -";
	var DELIVERY = "Delivery";
	var customerInfo;
	var globalCustomerId = '';
	var deliveryAddressArray = [];
	var address = "";
	var city = "";
	var state = "";
	var taxList = [];
	var creditAmount=0;
	var cc_total=0;
	var  cc_Data=null;
	var taxOrderListArray=[];
	var deliveryArea = "";
	var defaultCity = "Gurgaon, Haryana";
	var mobileNumberKey = 'SALAD_DAYS_MOBILE_NUMBER_KEY';
	var mobileUpdateTimeKey = 'SALD_DAYS_MOBILE_UPDATE_TIME_KEY';
	var expiryDurationInMS = 1000 * 60 * 5; //5 minutes
	var customerDeliveryArea;
	var customerAddress;
	var isDisplayingNewAddressElements = false;
	var imageURLPrefix = 'https://www.cookedspecially.com';
	//var imageURLPrefix = 'http://localhost:8081';
	var items = [];
	var cartSubtotal = 0;
	var VAT = 0;
	var serverDate;
	var currentServerDate;
	var countryCode="+91";
	var theOptions = null;
	var areas = [];
	var priceOnCheck;
	var customerCredit;
	var billingCycle;
	var paymentType=undefined;
	var cartTitle = document.getElementById("cartTitle");
	var delTimeLabel = document.getElementById("delivery-time-label");

	var a = document.getElementsByClassName("keepShoppingLink"); //or grab it by tagname etc

	if(sessionStorage.getItem("CART")== "CART_ME_MENU")
	{
		cartTitle.innerHTML = "SERVING TIME: 0700 TO 0900 HOURS";
		delTimeLabel.innerHTML = "Select Morning Express Delivery Time";

		for (var i = 0; i < a.length; i++) {
			a[i].href = "me_menu.html";
		}

		$.getJSON(apiPrefix + "/menu/getjson/115", function(data) {
			sections = data.sections;
			setup();
		});
	}
	else{
		cartTitle.innerHTML = "SERVING TIME: 0945 TO 2345 HOURS.";
		delTimeLabel.innerHTML = "Select Delivery Time";


		for (var i = 0; i < a.length; i++) {
			a[i].href = "menu.html?restaurantId="+restaurantId;
		}

		$.getJSON(apiPrefix + "/menu/getallmenusjson/" + restaurantId, function(data) {
			sections = data.menus[0].sections;
			setup();
		});

	}

	$.getJSON(apiPrefix + "/restaurant/getrestaurantinfo?restaurantId=" + restaurantId, function(data) {
		city = data.city;
		state = data.state;
		taxList = data.taxList;
		$("#serviceTaxValue").text(data.serviceTaxText);
	});

	function backToMenu(){
		window.location.href = "menu.html?restaurantId="+restaurantId;
		}

	function isOpen() {
		if (alwaysOpen) {
			return true;
		}
		else if (closedToday) {
			return false;
		}
		else if (normalHour) {
			// Opening hour in UTC is 16, Closing hour is 0 the next day
			var d      = new Date(),
					open   = new Date(),
					closed = new Date();

			open.setUTCHours(3);
			open.setUTCMinutes(30);
			open.setUTCSeconds(0);
			open.setUTCMilliseconds(0);

			closed.setUTCHours(16);
			closed.setUTCMinutes(30);
			closed.setUTCSeconds(0);
			closed.setUTCMilliseconds(0);
			return !!(d > open && d < closed);
		}
	}

	function getURLParameter(sParam){
	    var sPageURL = window.location.search.substring(1);
	    var sURLVariables = sPageURL.split('&');
	    for (var i = 0; i < sURLVariables.length; i++)
	    {
	        var sParameterName = sURLVariables[i].split('=');
	        if (sParameterName[0] == sParam)
	        {
	            return sParameterName[1];
	        }
	    }
	}

	function validateName() {
		var name = $('#name-field').val();
		if (name == undefined || name.trim() == '') {
			alert('Please enter your name to be able to place your order.');
			return false;
		} else {
			customerInfo.firstName = name.split(' ').slice(0, -1).join(' ');
			customerInfo.lastName = name.split(' ').slice(-1).join(' ');
			return true;
		}
	}

	function validateAddress() {
		if (isDisplayingNewAddressElements) {
			var address = $('#address-field').val().trim();
			if (address != undefined && address != '' && address != null) {
				customerInfo.address = address;
				customerInfo.city = defaultCity;
				return true;
			} else {
				alert('Please enter an address to be able to place your order.');
				return false;
			}
		} else {
			myAddress();
			if (customerAddress == null || customerAddress == '' || customerAddress == undefined) {
				alert('Please enter an address to be able to place your order.');
				return false;
			} else {
				customerInfo.address = customerAddress;
				//customerInfo.city = defaultCity;
				customerInfo.deliveryArea = customerDeliveryArea;
				return true;
			}
		}
	}

	function validateEmail() {
		var emailMatch = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$/;
		var email = $('#email-field').val().trim();
		if (email != undefined && email != '' && email != null) {
			if (emailMatch.test(email)) {
				customerInfo.email = email;
				return true;
			} else {
				alert('Please enter a valid email to be able to place your order.');
				return false;
			}
		} else {
			alert('Please enter a valid email to be able to place your order.');
			return false;
		}
	}

	function validateDeliveryArea() {
		if (isDisplayingNewAddressElements) {
			var area = $('#select-delivery-area').find(":selected").text().trim();
			if (area != chooseDeliveryAreaPrompt && area != '' && area != null && area != undefined) {
				customerInfo.deliveryArea = area;
				if (area != customerDeliveryArea) {
					customerDeliveryArea = area;
				}
				return true;
			} else {
				alert('Please enter a valid delivery area to be able to place your order.');
				return false;
			}
		} else {
			if (customerDeliveryArea == null || customerDeliveryArea == '' || customerDeliveryArea == undefined) {
				alert('Please enter a valid delivery area to be able to place your order.');
				return false;
			} else {
				customerInfo.deliveryArea = customerDeliveryArea;
				return true;
			}
		}
	}

	function validateDeliveryDay() {
		return true;//Currently it is impossible to enter an invalid delivery day.
	}

	//Date conversion utility
	//convert from "mm-dd-yyyy" to "mm/dd/yyyy"
	function getSlashFormattedDateString(strDate)
	{
		var arrDate = strDate.split("-");
		if((arrDate != null) && arrDate.length >= 3) {
			return arrDate[0] + "/" + arrDate[1] + "/" + arrDate[2];
		}
		return null;
	}

	//return "mm-dd-yyyy"
	function getFormattedDateString(date) {
		var year = date.getFullYear();
		var month = (1 + date.getMonth()).toString();
		month = month.length > 1 ? month : '0' + month;
		var day = date.getDate().toString();
		day = day.length > 1 ? day : '0' + day;
		return month + '-' + day + '-' + year;
	}

	function validateDeliveryTime() {
		var time = $('#select-delivery-time').find(":selected").text().trim();
		if (time != chooseDeliveryTimePrompt && time != '' && time != undefined && time != null) {
			if(sessionStorage.getItem("CART")=="CART_ME_MENU") {
				var comparDate = currentServerDate;
				comparDate.setHours(21);
				comparDate.setMinutes(0);
				var dt = new Date(currentServerDate.getTime()) ;
				
				var date  = new Date();
				if(date>comparDate){
					alert("Sorry! You can place the order for Morning Express only before 9 PM.");
					$('#select-delivery-time').val("- Delivery Time -");
					$("#select-delivery-time option[value='- Delivery Time -']").attr('selected','selected');
					//$('#select-delivery-time').text("- Delivery Time -");
					return false;
				}
				
				dt.setDate(dt.getDate() + 1);
				var dtStr = getFormattedDateString(dt);
				customerInfo.deliveryTime = dtStr + " " + time;
			}
				else{
				customerInfo.deliveryTime = serverDate + " " + time;
			}
			return true;
		} else {
			alert('Please choose a delivery time to be able to place your order.');
			return false;
		}
	}

	function validatePaymentMethod() {
		if ($("input:radio[name='payment-method']").is(":checked")) {
			return true;
		} else {
			alert('Please choose a payment method to be able to place your order.');
			return false;
		}
	}

	function validateFields() {
		return (validateName() && validateAddress() && validateEmail() && validateDeliveryArea() && validateDeliveryDay() && validateDeliveryTime());
	}

	function isEmpty(toCheck) {
		return (toCheck == undefined || toCheck == null || toCheck == 'null' || toCheck == '');
	}

	function persistMobileToLocalStorage(mobileString) {
		localStorage.setItem(mobileNumberKey, mobileString);
		localStorage.setItem(mobileUpdateTimeKey, Date.now() + expiryDurationInMS)
	}

	function autoPopulateMobileNumberFieldIfNotExpired() {
		var time = localStorage.getItem(mobileUpdateTimeKey);
		if ((time != undefined && time != null) && time < Date.now()) {
			localStorage.removeItem(mobileNumberKey);
			localStorage.removeItem(mobileUpdateTimeKey);
			return;
		}
		var number = localStorage.getItem(mobileNumberKey);
		if (number != null && number != undefined) {
			$("input#customerPhone").val(number);
			//readCookie();
//			acceptPhoneNumber();
		}
	}

	function readCookie() {
		var allcookies = document.cookie;
        // Get all the cookies pairs in an array
        cookiearray = allcookies.split(';');
        // Now take key value pair out of this array
        for(var i=0; i<cookiearray.length; i++){
           name = cookiearray[i].split('=')[0];
           value = cookiearray[i].split('=')[1];
           if(name.trim() == "customer") {
       		fetchCustomerInfoAndPopulateFields("&phone=" + encodeURIComponent(value));
           }
        }
        
	}
	function showAddNewAddressElements() {
		var currentCity = city;
		var currentState ;
		if(state==""){
			currentState ="";
		}else{
		currentState = ", "+state;
		}
		var newAddressHTML = '<input type="text" id="address-field" placeholder="Street Address"><select id="select-delivery-area"></select>';/* <br><span id="cityState">'+currentCity+' '+currentState+'</span> */;
		$('#address-options').append(newAddressHTML);
		isDisplayingNewAddressElements = true;
		displayDeliveryAreas(true);
		$("#address-field").change(function () {
			customerAddress = $("#address-field").val();
		});
		$("#select-delivery-area").change(function () {
			customerDeliveryArea = $('#select-delivery-area').find(":selected").text().trim();
			updateDeliveryChargesAndTotal();
		});
		customerDeliveryArea = chooseDeliveryAreaPrompt;
	}

	function myAddress() {
		var deliveryAddressId = $("#address-options input[name=address2]:checked").val();
		if (deliveryAddressId == "addAddress") {
			if (!isDisplayingNewAddressElements) {
				showAddNewAddressElements();
			}
		} else if (deliveryAddressId != null && deliveryAddressId != '') {
			isDisplayingNewAddressElements = false;
			$('#address-field').remove();
			$('#select-delivery-area').remove();
			//$("#cityState").remove();
			deliveryAddressArray.forEach(function (address) {
				if (address.id == deliveryAddressId) {
					customerDeliveryArea = address.deliveryArea;
					customerAddress = address.customerAddress;
					updateDeliveryChargesAndTotal();
				}
			});
		}
	}

	function populateDeliveryAreaOfCustomer() {
		if (customerDeliveryArea != null && customerDeliveryArea != undefined && customerDeliveryArea != '') {
			$('#select-delivery-area').val(customerDeliveryArea);
			updateDeliveryChargesAndTotal();
		}
	}

	function pouplateFields(info) {
		if (isEmpty(info.firstName) && !isEmpty(info.lastName)) {
			$('#name-field').val(info.lastName);
		}
		else if (!isEmpty(info.firstName) && !isEmpty(info.lastName)) {
			$('#name-field').val(info.firstName + ' ' + info.lastName);
		}
		$('#address-field').val(info.address);
		$('#email-field').val(info.email);
		customerDeliveryArea = info.deliveryArea;
		populateDeliveryAreaOfCustomer();
		addCustomerCookie(info.phone);
	}

	function addCustomerCookie(phone) {
		var now = new Date();
		now.setMonth( now.getMonth() + 12 );
		//var value = [customer.customerId, customer.firstName, customer.lastName, customer.address, customer.city, customer.phone, customer.email, customer.deliveryArea;
		document.cookie = "customer="+phone+"; expires=" + now.toUTCString();
	}
	
	function fetchCustomerInfoAndPopulateFields(custIdParam) {
		var customer;
		var custInfoUrl = apiPrefix + _custInfo + custIdParam;
		var CustInfoPromise = $.ajax({
			type: "POST",
		    contentType: "charset=utf-8",
		    url: custInfoUrl,
		});
		CustInfoPromise.then(function (data) {
			console.log(data);
			populateCustomerDetails(data);
				},
				function () {
					  alert("Error: \nBad network. Arghh!\nPls call us on 9643 800 901.");
				});
		CustInfoPromise.complete(function () {
//			workflowValidated = true;
//TODO			$( "#popupContact" ).popup( "close" );
		});
	}
	var totalWithCC=0;
	function validateCustomreCreditAmount(){
		if(cc_Data!=null){
					creditAmount=cc_Data.creditBalance;
					if(creditAmount<0 && cc_Data.creditType.billingCycle=="ONE_OFF"){
						if((-creditAmount)>=cc_total && cc_Data.creditType.billingCycle=="ONE_OFF"){
							$("#hide_me").hide();
							totalWithCC=0;
							paymentType="CUSTOMER CREDIT";
							$("#credt_total_amount").text(totalWithCC);
							$("#credit-amount").text(creditAmount);
							$("#totalWithCreditRow").show();
						$("#creditRow").show();
						}else{
							$("#hide_me").show();
							paymentType=undefined;
							totalWithCC = Number(cc_total)+Number(creditAmount);
							$("#credt_total_amount").text(totalWithCC);
							$("#credit-amount").text(creditAmount);
							$("#totalWithCreditRow").show();
							$("#creditRow").show();
						}	
				}else if(creditAmount>0 && cc_Data.creditType.billingCycle=="ONE_OFF"){
						//$("#creditBalanceDiv").hide();
						paymentType=undefined;
						totalWithCC = Number(cc_total)+Number(creditAmount);
						$("#credt_total_amount").text(totalWithCC);
						$("#credit-amount").text(creditAmount);
						$("#totalWithCreditRow").show();
						$("#creditRow").show();
				}
			}else {
				$("#totalWithCreditRow").hide();
				$("#creditRow").hide();
			}
	}
	
	function populateCustomerDetails(data) {
		if (data.customers[0].customerId > 0) {
			customerInfo = data.customers[0];
			customerCredit=customerInfo.credit;
			cc_Data=customerCredit;
			validateCustomreCreditAmount();
			if(customerCredit!=null)
			billingCycle=customerInfo.credit.creditType.billingCycle;
			globalCustomerId = data.customers[0].customerId;
			pouplateFields(customerInfo);
			updateDeliveryChargesAndTotal();
			customer = data.customers[0];
			if(customerCredit!=null && billingCycle!='ONE_OFF')
				{
				$('#optionWithCredit').show();
				$("#optionCustomerCredit").attr('checked', 'checked');
				}
			else{
				$('#optionWithCredit').hide();
				$("#optionCOD").attr('checked', 'checked');
			}
			
			$('#sign-in-div').hide();
			$('#auto-fill-details').show();
			$(".logout").show();
		}

		if (data.newCustomer) {
			showAddNewAddressElements();
		} else {
			if ((data.customerAddress == [] || data.customerAddress.length == 0 || data.customerAddress == null || data.customerAddress == undefined) && customer.address != null && customer.address != '' && customer.address != undefined) {
				$('.address-options').append($('<label class="address-option" ><input type="radio"  id="fdata" checked="checked" onclick="myAddress()" name="address2" value="fdata">&nbsp ' + customer.address + ', ' + customer.deliveryArea + ', ' + customer.city + '</input></label>'));
				$('.address-options').append($('<label class="address-option" ><input type="radio"  id="addAddress" onclick="myAddress()" name="address2" value="addAddress" >&nbsp Add New Address</input></label>'));
				customerAddress = customer.address;
				customerDeliveryArea = customer.deliveryArea;
			} else if (data.customerAddress != null && data.customerAddress != [] && data.customerAddress != "") {
				$.each(data.customerAddress, function (key, value) {
					var customerAddress = value.customerAddress;
					var deliveryArea = value.deliveryArea;
					var currentArea = value;
					currentArea.customerAddress = customerAddress;
					currentArea.deliveryArea = deliveryArea;
					deliveryAddressArray.push(currentArea);
					var comma  = "";
					if(value.state!=''){
					comma = ",";
					}
					if (customer.address != null && deliveryArea == customer.deliveryArea && customerAddress == customer.address) {
						$('.address-options').append($('<label class="address-option" ><input type="radio" checked="checked" id=" ' + value.id + '" onclick="myAddress()" name="address2" value="' + value.id + '" >&nbsp ' + value.customerAddress + ', ' + value.deliveryArea + ', ' + value.city +' '+comma+' '+value.state+'</input></label>'));
						customerAddress = value.customerAddress;
						customerDeliveryArea = value.deliveryArea;
					}
					else {
						$('.address-options').append($('<label class="address-option" ><input type="radio"  id="' + value.id + '" onclick="myAddress()" name="address2" value="' + value.id + '" >&nbsp ' + value.customerAddress + ', ' + value.deliveryArea + ', ' + value.city +' '+comma+' '+value.state+'</input></label>'));
					}
				});
				$('.address-options').append($('<label class="address-option" ><input type="radio"  id="addAddress" onclick="myAddress()" name="address2" value="addAddress" >&nbsp Add New Address</input></label>'));
			}
			else {
				showAddNewAddressElements();
			}
		}
	}

	function resetAddresses() {
		$('#address-options').empty();
	}

	function acceptPhoneNumber() {
		resetAddresses();
		countryCode = $("#countryCode option:selected").text()
		var customerPhone = $("input#customerPhone").val().trim().toLowerCase();
		if (phoneMatch.test(customerPhone)) {
			var cleanPhoneNumber = customerPhone.replace(phoneClean, "");
			//custIdParam = "&phone="+countryCode+""+cleanPhoneNumber;
			var phone = countryCode+""+cleanPhoneNumber;
			custIdParam = "&phone="+encodeURIComponent(phone);
			$("input#customerPhone").val(cleanPhoneNumber);
			persistMobileToLocalStorage(cleanPhoneNumber);
			customerData.phone=countryCode+""+cleanPhoneNumber;
			fetchNewOTP();
			
			//TODO show spinner
		} else {
			alert('Please enter a valid 10 phone number without the country code (+91)');
		}
	}
	
	
	function displayDeliveryAreas(withoutSettingCustomerDeliveryArea) {
		withoutSettingCustomerDeliveryArea = withoutSettingCustomerDeliveryArea || false;

		var delivery = [];
		var _deliveryAreaInfo = '/restaurant/getDeliveryAreas?';
		var deliveryAreaInfoUrl = apiPrefix + _deliveryAreaInfo + "restaurantId=" + restaurantId;
		var displayDeliveryAreaPro = $.ajax({
			crossDomain: true,
			type: 'GET',
			url: deliveryAreaInfoUrl,
			dataType: 'json'
		});
		displayDeliveryAreaPro.then(function (data) {
			var optionCount = 0;
			var selectDeliveryArea = $('#select-delivery-area');
			selectDeliveryArea.html('')
			var theOptions = '<option id="placeholder" data-placeholder="true" value="' + chooseDeliveryAreaPrompt + '">' + chooseDeliveryAreaPrompt + '</option>';
			$.each(data, function () {
				theOptions = theOptions + '<option value="' + this.name + '">' + this.name + '</option>';
				var name = this.name;
				var deliveryCharges = this.deliveryCharges;
				var minDeliveryThreshold = this.minDeliveryThreshold;
				var currentArea = this;
				currentArea.name = name;
				currentArea.deliveryCharges = deliveryCharges;
				currentArea.minDeliveryThreshold = minDeliveryThreshold;
				areas.push(currentArea);
				optionCount++;
			});
			if (optionCount > 1) {
				selectDeliveryArea.html(theOptions);
				if (!withoutSettingCustomerDeliveryArea) {
					populateDeliveryAreaOfCustomer();
					displayDeliveryTimeForChosenDay();
				} else {
					updateDeliveryChargesAndTotal();
					displayDeliveryTimeForChosenDay();
				}
			}
		}, function () {
//				console.log("AJAX: get delivery zone info FAILED. " + deliveryAreaInfoUrl);
		});
		return false;
	}

	function updateDeliveryChargesAndTotal() {
		var area = customerDeliveryArea;
		var validArea = false;
		
		for (var k = 0; k < areas.length; k++) {
			if (areas[k].name.trim() == area) {
				console.log(areas[k].deliveryCharges);
				$('#delivery-amount').text('₹' + areas[k].deliveryCharges);
				var vatTotal=0;
				$.each(taxOrderListArray, function(key,val ) {
					vatTotal +=val.value;
				});

				var total = parseFloat(areas[k].deliveryCharges + cartSubtotal +vatTotal).toFixed(0);
				cc_total =total;
				$('#total-amount').text('₹' + total);
				validArea = true;
				break;
			}
		}
		validateCustomreCreditAmount();
		if (!validArea) {
			$('#delivery-amount').text('');
			$('#total-amount').text('');
		}
	}

	function setDeliveryDayToTomorrow() {
		$('#select-delivery-day').val('Deliver Tomorrow');
	}

	function displayDeliveryDayAndTimeForMoEx() {
//VB how to fecth time

     var _getcurrentTime = apiPrefix + '/restaurant/time.json?tz="Asia/Kolkata"';
		console.log(_getcurrentTime);
		var displayDeliveryTimePro = $.ajax({
			crossDomain: true,
			type: 'GET',
			url: _getcurrentTime,
			dataType: 'json'
		});

		displayDeliveryTimePro.then(function (data)
		{
			//new Date(2011, 01, 07);
			console.log("fetched from server current Date.Date:" + data.date);
			//convert it to a string which all browser understand for date conversion object
			var newSlashDate = getSlashFormattedDateString(data.date);
			console.log("newSlashDate: " + newSlashDate);
			//Now convert it to the Date
			currentServerDate = new Date(newSlashDate);//(data.date)
			console.log("currentServerDate: " + currentServerDate);
			//create new duplicate to make tomorrows.
			var dt = new Date(currentServerDate.getTime());
			dt.setDate(dt.getDate() + 1);
			console.log("dt2:" + dt);
			//append it as required
			var dtStr = "Deliver Tomorrow (" + getFormattedDateString(dt)+ ")";
			console.log("dtStr:" + dt);

			//Hard coded as no api is in backend as of now
			theOptions = null;
			theOptions = '<option value="Deliver Tomorrow">' + dtStr +'</option>';
			$('#select-delivery-day').html('');
			$('#select-delivery-day').html(theOptions);


		}, function()
		{
			theOptions = '<option value="Deliver Tomorrow"></option>';
			$('#select-delivery-day').html('');
			$('#select-delivery-day').html(theOptions);
			  alert("Error: \nBad network. Arghh!\nPls call us on 9643 800 901.");
		});
		displayDeliveryTimePro.complete(function () {
			//Hard coded as no api is in backend as of now
			theOptions = null;
			theOptions = '<option id="placeholder" data-theme="d" data-placeholder="true" value="' + chooseDeliveryTimePrompt + '">' + chooseDeliveryTimePrompt + '</option>';
			theOptions = theOptions + '<option data-theme="d" value="07:00">07:00</option>';
			theOptions = theOptions + '<option data-theme="d" value="07:30">07:30</option>';
			theOptions = theOptions + '<option data-theme="d" value="08:00">08:00</option>';
			theOptions = theOptions + '<option data-theme="d" value="08:30">08:30</option>';
			theOptions = theOptions + '<option data-theme="d" value="09:00">09:00</option>';
			$('#select-delivery-time').html('');
			$('#select-delivery-time').html(theOptions);
			//setTimeout(function(){ $.mobile.loading( "hide" );$(".ui-fixed-hidden").removeClass("ui-fixed-hidden");$( "#popupContact"  ).popup( 'open' ); },1000);
		});

	}
////www.stage.cookedspecially.com/CookedSpecially/restaurant/time.json?tz=%22IST%22;
	function validateDeliveryAreaOnClick(area){
		var repeat=true;
		for (var k = 0; k < areas.length; k++) {
			if (areas[k].name.trim() == area) {
					if(areas[k].todayTimeJson==null && area==areas[k].name) {
						/* if(repeat){
						alert("Sorry, for "+areas[k].name+" delivery area you can place order for tomorrow only");
						repeat=false; }*/
						
						$('#select-delivery-day').val('Deliver Tomorrow');
						displayDeliveryTimeForChosenDay()
					}
				}
				
			}
	}
		function displayDeliveryTime(days) {
		var data;
		var area = customerDeliveryArea;
		var repeat=true;
		for (var k = 0; k < areas.length; k++) {
			if (areas[k].name.trim() == area) {
				if(days=="today"){
					data=areas[k].todayTimeJson;
					if(areas[k].todayTimeJson==null && area==areas[k].name) {
					if(repeat) {
						alert("Sorry, for this delivery area you can place order for tomorrow only");
						repeat=false;
					}
						data=areas[k].tomorrowTimeJson;
						$('#select-delivery-day').val('Deliver Tomorrow');
					}
				}
				if(days=="tomorrow"){
					data=areas[k].tomorrowTimeJson;
				}
			}else{
				$("#delivery-time-label").show();
				$("#deliveryTimeDiv").show();
				if(areas[k].todayTimeJson!=null){
				if(days=="today"){
					data=areas[k].todayTimeJson;
				}
				if(days=="tomorrow"){
					data=areas[k].tomorrowTimeJson;
				}
				}
			}
		}
		
			serverDate = data.date;
			theOptions = '<option id="placeholder" data-theme="d" data-placeholder="true" value="' + chooseDeliveryTimePrompt + '">' + chooseDeliveryTimePrompt + '</option>';
			var optionCount = 0;
			$('#select-delivery-time').html('');
			for (var i = 0; i < data.dateList.length; i++) {
				defaultTime = data.dateList[0];
//TODO				$("#select-delivery-time-button > span").text(data.dateList[0]);
				theOptions = theOptions + '<option data-theme="d" value="' + data.dateList[i] + '">' + data.dateList[i] + '</option>';
				optionCount++;
			}
			if (optionCount >= 1) {
//				$("#popupDeliveryTime button#continue").removeClass("ui-disabled");
				$('#select-delivery-time').html(theOptions);
//				$('#time_warning').text('');
			}
			else {
				//alert('Oops! We\'re Closed for Today, we\'re open from ' +restaurantOpenTime+ ' to ' +restaurantCloseTime+'. You can order for Tomorrow');
				$('#validationModal').modal('show');
				alert('Oops! We\'re Closed for Today, we\'re open from 9am to 11pm. You can order for Tomorrow');
				//$("#validateMsg").text('Oops! We\'re Closed for Today, we\'re open from ' +restaurantOpenTime+ ' to ' +restaurantCloseTime+'. You can order for Tomorrow');
				setDeliveryDayToTomorrow();
				displayDeliveryTimeForChosenDay();
//TODO FINDME
			}
			$("#select-delivery-time option:contains(" + defaultTime + ")").attr('selected', 'selected');
		
	}
	
	function displayDeliveryTimeForChosenDay() {
		var selectDeliveryDay = $("#select-delivery-day");
		if (selectDeliveryDay.val() == "Deliver Today") {
			displayDeliveryTime("today");
		}
		if (selectDeliveryDay.val() == "Deliver Tomorrow") {
			if(sessionStorage.getItem("CART")== "CART_ME_MENU") {
				$("#deliveryTimeDiv").show();
			}else{
				displayDeliveryTime("tomorrow");
			} 
		}
	}
	
	function updateCartSubTotal() {
		var total = 0;
		taxOrderListArray=[];
		
		items.forEach(function (item) {
			var specialTaxValue=0;
			var specialTaxName=0;
			if (item.itemId in sessionStorage) {
				total += Number(sessionStorage.getItem(String(item.itemId))) * item.price;
				$.each(taxList, function(k, v) {
					if(v.dishType=="Default"){
					var counter =0;
					$.each(taxList, function(i, j) {
						if(j.dishType==item.itemType){
						if(v.taxTypeId==j.overridden){
							if(v.chargeType=="PERCENTAGE"){
								var quantity =Number(sessionStorage.getItem(String(item.itemId)));
								specialTaxValue=parseFloat((j.taxValue*item.price)/100).toFixed(2)*quantity;
								specialTaxName=j.name;
								counter++;
								}else if(v.chargeType=="ABSOLUTE"){
									specialTaxValue = j.taxValue*quantity;
									specialTaxName=j.name;
									}
						}
					    }
					});
					if(counter!=1){
						var quantity =Number(sessionStorage.getItem(String(item.itemId)));
						var vat=0;
						if(v.chargeType=="PERCENTAGE"){
							 vat = parseFloat((v.taxValue*item.price)/100).toFixed(2)*quantity;
							}
						  else if(v.chargeType=="ABSOLUTE"){
							 vat = v.taxValue*quantity;
						}
						
						
						var  taxOrderList={};
						taxOrderList.name=v.name;
						taxOrderList.value=Number(vat);
						var count=0;
						var countAy=0;
						if(taxOrderListArray.length>0){
							$.each(taxOrderListArray, function(o, p){
								if(taxOrderListArray[count].name==v.name){
									taxOrderListArray[count].value +=Number(vat);
									countAy++;
								}
								count++;
							});
						}
						if(countAy==0){
						    taxOrderListArray.push(taxOrderList);
						}
						}
					else if(counter==1){
						
						var ct=0;
						var count=0;
						var countAy=0;
						var  taxOrderList={};
						if(taxOrderListArray.length>0){
							$.each(taxOrderListArray, function(o,p) {
								if(taxOrderListArray[count].name==specialTaxName){
								taxOrderListArray[count].value +=Number(specialTaxValue);
								countAy++;
								}
								count++;
							});
						}
						taxOrderList.value=Number(specialTaxValue);
						taxOrderList.name = specialTaxName;
						if(countAy==0){
						    taxOrderListArray.push(taxOrderList);
						}
						}
					}
				});
			};
		});
		
		validateCustomreCreditAmount();
		$("#taxBody").html("");
		taxOrderListArray.sort(keysrt('name'));
		$.each(taxOrderListArray, function(k, v) {
		  var $row = $('<tr class="total-rows"><td class="cart_product"></td>'+
				  	'<td class="cart_description"><p>'+v.name+'</p></td>'+
				  	'<td class="cart_price"></td>'+
				  	'<td class="cart_quantity"></td>'+
				  	'<td class="cart_total" id="VAT">'+parseFloat(v.value).toFixed(2)+'</td></tr>');    
		    $("#taxBody").append($row);
		});
		cartSubtotal = total;
		$('#subtotal-amount').text('₹' + total);
		//VAT = parseFloat(0.1313 * total).toFixed(2);
		updateDeliveryChargesAndTotal();
	}

	function keysrt(key,desc) {
		  return function(a,b){
		   return desc ? ~~(a[key] < b[key]) : ~~(a[key] > b[key]);
		  }
		}
	
	function getItemWithId(id) {
		return items.filter(function (el) {
			return (el.itemId === id);
		})[0];
	}

	function removeItemFromCart(itemId) {
		$('#row_' + itemId).remove();
		sessionStorage.removeItem(String(itemId));
		if(sessionStorage.length == 1)
		{
			sessionStorage.clear();//remove the CART item too
		}
		updateCartSubTotal();
		updateDeliveryChargesAndTotal();
	}

	function setQuantity(itemId, count, cost) {
		var item = sessionStorage.getItem(String(itemId));
		sessionStorage.setItem(String(itemId), String(count));
		if (count == 0) {
			removeItemFromCart(itemId);
		} else {
			$('#total_' + itemId).text('₹' + String(count * cost));
		}
		;
		updateCartSubTotal();
		updateDeliveryChargesAndTotal();
	}

	function change(itemId, multiplier, cost) {
		console.log(itemId);
		var val;
		var item = sessionStorage.getItem(String(itemId));
		if (item == undefined || item == null || item == 'null') {
			sessionStorage.setItem(String(itemId), '1');
			val = 1;
		} else {
			val = Number(sessionStorage.getItem(String(itemId))) + (1 * multiplier);
			sessionStorage.setItem(String(itemId), val);
		}
		;
		if (val == 0) {
			removeItemFromCart(itemId);
		} else {
			$('#count_' + itemId).val(val);
			$('#total_' + itemId).text('₹' + String(val * cost));
		}
		;
		updateCartSubTotal();
	}

	function addRow(item, count) {
		var imageURL = imageURLPrefix + item.imageUrl;
		var innerHTML =
						'<tr class="item-row" id="row_' + item.itemId +
						'"> <td class="cart_product">' +
						'<img class="cart_image" style="width: 100%;" src="' + imageURL + '" alt="">' +
						'</td><td class="cart_description"><p>' + item.name + '</p></td>' +
						'<td class="cart_price"><p>₹' + item.price + '</p></td><td class="cart_quantity">' +
						'<div class="cart_quantity_button"><a id="a-t-c-p_' + item.itemId + '" class="cart_quantity_up" href=""><i class="fa fa-plus"></i></a>' +
						'<input id="count_' + item.itemId + '" class="cart_quantity_input" type="text" name="quantity" value="' + count + '" autocomplete="off" size="3">' +
						'<a id="a-t-c-m_' + item.itemId + '" class="cart_quantity_down" href=""><i class="fa fa-minus"></i></a></div></td><td class="cart_total">' +
						'<p class="cart_total_price" id="total_' + item.itemId + '">₹' + count * Number(item.price) + '</p></td><td class="cart_delete">' +
						'<a id="a-t-c-d_' + item.itemId + '" class="cart_quantity_delete" href=""><i class="fa fa-times"></i></a></td></tr>';
		// console.log(innerHTML);
		$('#cart-items-table-body').prepend(innerHTML);
	}

	function populateCartItems() {
		$('.item-row').remove();
		sections.forEach(function (section) {
			section.items.forEach(function (item) {
				if (item.itemId in sessionStorage) {
					items.push(item);
					addRow(item, Number(sessionStorage.getItem(String(item.itemId))));
				}
				;
			});
		});
		updateCartSubTotal();
	}

	function setClickFunctions() {
		items.forEach(function (item) {
			$('#a-t-c-p_' + item.itemId).click(function () {
				change(item.itemId, 1, item.price);
				return false;
			});
			$('#a-t-c-m_' + item.itemId).click(function () {
				change(item.itemId, -1, item.price);
				return false;
			});
			$('#a-t-c-d_' + item.itemId).click(function () {
				removeItemFromCart(item.itemId);
				return false;
			});
			$('#count_' + item.itemId).change(function () {
				var count = Number($('#count_' + item.itemId).val());
				console.log(count);
				if (count <= 999 && count >= 0) {
					setQuantity(item.itemId, count, item.price);
				} else {
					var count = Number(sessionStorage.getItem(String(item.itemId)));
					$('#count_' + item.itemId).val(count);
					alert('Please enter a quantity between 0 and 999.');
				}
				;
			});
		});
	}

	function proceedButtonPressed() {
		if (validateFields()) {
			cleanCustomerInfo();
			setCustInfoAndPlaceOrder();
		}
	}

	function displayCheckFromAPI(restaurantId, customerId, checkId, data) {
		var generateCheckApi = apiPrefix + "/order/generateCheckForPrint?templateName=saladdaysbill&checkId=" + checkId;
		var displayCheckPro = $.ajax(generateCheckApi, {
			isLocal: false
		})
		displayCheckPro.then(function (data) {
			console.log("ajax success: " + generateCheckApi);

			var theCheckIdForEmail = '<div style="display:none" id="checkId">' + checkId + '</div>';
			$(theCheckIdForEmail).appendTo("#footer");
			var theCheck = '' +
					'<div id="check' + checkId + '" class="check">' +
					'</div>';
			$(theCheck).appendTo("#check");
			$(data).appendTo("#check" + checkId);
			$('#check').show();
			$('#user-details').hide();
			$('#cart-items').hide();
			hideLogo();
			history.pushState(null, null, document.URL+"/receipt");
		}, function () {
			  alert("Error: \nBad network. Arghh!\nPls call us on 9643 800 901.");
		});
		displayCheckPro.complete(function () {
			console.log("ajax complete: " + generateCheckApi);
		});
	}

	function getNumberOfItems() {
		for (var i = 0; i < sessionStorage.length; i++) {
			if(sessionStorage.key(i) === 'CART')
				continue;
			numberOfItems += Number(sessionStorage.getItem(sessionStorage.key(i)));
		}
	}

	function confirmOrderAndPayment(status){
		if(status=="Online") {
			window.location.href = _payOnline + "restaurantId=" + restaurantId + "&checkId=" + globalCheckId;
		}else if(status=="MobiKwikWallet"){
		window.location.href = _payByWallet + "restaurantId=" + restaurantId + "&checkId=" + globalCheckId;
		}
		else if(status=="payTm"){
		window.location.href = _payBypayTm + "restaurantId=" + restaurantId + "&checkId=" + globalCheckId;
		}
	}

	/* function setCheckType(checkId, type) {
		var deferred = $.Deferred();
		var typeApi = apiPrefix + "/order/setCheckType?checkId=" + checkId + "&type=" + type;
		var setCheckTypePro = $.ajax(typeApi, {
			isLocal: false
		});
		setCheckTypePro.then(function (data) {
			console.log("ajax success: " + typeApi);
			deferred.resolve();
			console.log(JSON.stringify(data));
		}, function () {
			//alert("ajax error: " + typeApi);
			//deferred.reject();
			deferred.resolve();
		});
		setCheckTypePro.complete(function () {
			console.log("ajax complete: " + typeApi);
		});
		return deferred.promise();
	} */

	function placeOrder(restaurantId, customerId, destinationType, paymentStatusValue) {

		var orderInstructions = $('textarea#instructions').val();
			var customerCopy ={};
		     customerCopy.name =  customerInfo.firstName +' '+customerInfo.lastName;
			 customerCopy.id=customerInfo.customerId;
			 customerCopy.phone = customerInfo.phone;
			 customerCopy.address = customerInfo.address;
			 customerCopy.deliveryArea = customerInfo.deliveryArea;
			 customerCopy.email = customerInfo.email;
			 customerCopy.city = customerInfo.city;
			 /* if(paymentType!=undefined){
			 	paymentStatusValue=paymentType;
			 	alert(paymentStatusValue);
			 } */
			var order = JSON.parse('{"instructions":"' +orderInstructions+ '","paymentMethod":"' + paymentStatusValue + '","orderType":"' + destinationType + '","deliveryDateTime":"'+customerInfo.deliveryTime+'","deliveryCharges":1,"items":[]}'); // Need to set sourceType and destinationType
	
			var addedInstructions = false;

			for (var i = 0; i < sessionStorage.length; i++) {
				if(!(sessionStorage.key(i) === 'CART' || sessionStorage.key(i) === 'cartId')) {
				 	var itemCount = Number(sessionStorage.getItem(sessionStorage.key(i)));
					var id = sessionStorage.key(i);
					var item = getItemWithId(Number(id));
					var name = item.name;
					var price = item.price;
					var quantity = itemCount;
					var smallImageUrl = item.smallImageUrl;
					var dishType = item.itemType;
					var instructions = '';
					if (addedInstructions == false) {
						instructions = $('textarea#instructions').val();
						addedInstructions = true;
					}
					var item = JSON.parse('{"itemId":' + item.itemId + ', "name":"' + name + '","price":' + price + ',"quantity":' + quantity +',"addOns":[],"smallImageUrl":"' + smallImageUrl + '","dishType":"' + dishType + '"}');
					
						
						if (instructions != '') {
							item.instructions = instructions;
							instructions = '';
						}
					order.items.push(item);
				}
			}

			var jsonString = '{"order":'+JSON.stringify(order)+',"customer":'+JSON.stringify(customerCopy)+'}';
			 console.log(jsonString);
			if (order.items.length > 0) {
				var _addToCheck = '/order/placeOrderFromPos?restaurantId='+restaurantId;
				var addToCheck = apiPrefix + _addToCheck;
				var addToCheckPro = $.ajax({
					type: "POST",
					contentType: "application/json; charset=utf-8",
					url: addToCheck,
					data: jsonString
				});
				addToCheckPro.then(function (data) {
					if (data.paymentType == "Online") {
						globalCheckId = data.checkId;
							cleanup();
							confirmOrderAndPayment(data.paymentType);
					}else if(data.paymentType == "MobiKwikWallet"){
						globalCheckId = data.checkId;
							cleanup();
							confirmOrderAndPayment(data.paymentType);
					}
					else if(data.paymentType == "payTm"){
						globalCheckId = data.checkId;
							cleanup();
							confirmOrderAndPayment(data.paymentType);
					}
					else if (data.paymentType == "COD") {
						globalCheckId = data.checkId;
							cleanup();
							displayCheckFromAPI(restaurantId, customerId, data.checkId, data);
						
					}
					else if (data.status == "Failed") {
						alert("We're sorry, but we've encountered an error: " + data.error);
					}else if (data.status == "error") {
						alert("We're sorry, but we've encountered an error: " + data.error);
					}
					 else {
						alert("We're sorry, but we've encountered an error.")
					}
				}, function () {
					  alert("Error: \nBad network. Arghh!\nPls call us on 9643 800 901.");
				});
				addToCheckPro.complete(function () {
					console.log("AJAX: Add to check COMPLETED");
				});
			}else{
				alert('You seem to have an empty cart. Go on! Add some delicious salads and juices from our menu and then click this button.')
			}

		console.log("DEBUG > END placeOrder(" + restaurantId + ")");
	}

	function cleanCustomerInfo() {
		delete customerInfo.userId;
		delete customerInfo.numberOfOrders;
		delete customerInfo.createdTime;
	}

	function setCustInfoAndPlaceOrder() {
				customerInfo.restaurantId =  restaurantId;
					var paymentStatusValue;
					if(paymentType!=undefined){
					 	paymentStatusValue=paymentType;
					 }else{
					 	paymentStatusValue = $("input[name=payment-method]:checked").val();
					 }
					console.log(paymentStatusValue);
					if(sessionStorage.getItem("CART")== "CART_ME_MENU")
					{
						placeOrder(restaurantId, globalCustomerId, "MorningExpress", paymentStatusValue);
					}
					else
					placeOrder(restaurantId, globalCustomerId, DELIVERY, paymentStatusValue);
	}

	function cleanup() {
		console.log('cleaning up');
		sessionStorage.clear();
		populateCartItems();
		cartSubtotal = 0;
		creditAmount=0;
	    cc_total=0;
	    cc_Data=null;
		items = [];
		$('#sign-in-div').show();
		$('#auto-fill-details').hide();
	}

	function setup () {
		$(".logout").hide();
		resetuserInputFields();
		populateCartItems();
		setClickFunctions();
		displayDeliveryAreas();
		autoPopulateMobileNumberFieldIfNotExpired();
		readCookie();
		
		/* else {
			//displayDeliveryTimeForChosenDay();
		} */
		$('#phone-number-button').click(function () {
			acceptPhoneNumber();
			return false;
		});
		$('#proceed-button').click(function () {
			if (sessionStorage.length == 0) {
				alert('You seem to have an empty cart. Go on! Add some delicious salads and juices from our menu and then click this button.')
			} else {
				proceedButtonPressed();
			}
			return false;
		});
		$("#select-delivery-time").change(function () {
			validateDeliveryTime();
		});
		$("#select-delivery-day").change(function () {
			displayDeliveryTimeForChosenDay();
			validateDeliveryDay();
		});
		if(sessionStorage.getItem("CART")== "CART_ME_MENU") {
			displayDeliveryDayAndTimeForMoEx();
			$("#deliveryTimeDiv").show();
		}
		$('#details-overlay').click(function () {
			alert('Please enter your mobile number to continue');
		})
	}

	//	function setHeightOfColumns() {
	//		if ($('#user-details').height() > $('#cart-items').height()) {
	//			$('#cart-items').height($('#user-details').height());
	//		} else {
	//			$('#user-details').height($('#cart-items').height());
	//		};
	//	}
function resetuserInputFields() {
	$("input#customerPhone").val("");
	$('#name-field').val("");
	$('#address-field').val("");
	$('#email-field').val("");	
}

function logout() {
	var now = new Date();
	 creditAmount=0;
	 cc_total=0;
	 cc_Data=null;
	document.cookie = "customer=; expires=" + now.toUTCString();
	resetAddresses();
	$('#sign-in-div').show();
	$('#auto-fill-details').hide();
	$(".logout").hide();
	$("input#customerPhone").val("");
}
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48447846-1', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>
