<!DOCTYPE html>
<html xmlns:fb="http://ogp.me/ns/fb#">
<head>
	<meta charset="utf-8" />
	<title>CookedSpecially</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<link href='//fonts.googleapis.com/css?family=Open+Sans:300,400' rel='stylesheet' type='text/css' />
	
	<link rel="stylesheet" href="//code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.css">
	<script src="//code.jquery.com/jquery-1.10.2.min.js">
	</script>
	<!-- script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script -->
	<!-- script src="//code.jquery.com/ui/1.10.3/jquery-ui.js"></script -->
	<script src="//code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.js">
	</script>

	<style>
	body {
	  font-family: "Lucida Sans Unicode", "Lucida Grande", "sans-serif";
	}
	.achtung {
		border-color:red !important;
	}
	.itemContent .title, .itemContent .description, .itemContent .price {
		white-space:normal;
		text-overflow:ellipsis;
	}
	.breadcrumb {
		font-size:xx-small;
		font-style:plain;
		font-weight:lighter;
		opacity: 0.7;
	}
	.smaller, .itemContent .description, .itemContent .price {
		font-size:smaller;
		font-style:plain;
		font-weight:normal;
	}
	.itemContent.title, .itemContent .description {
		padding-right:10px;
	}
	
	.ui-collapsible-heading, .ui-collapsible-content {
		opacity: 0.7;
	}
	.itemContent .title .icon-info, .itemContent .price {
		float: right;
		padding-right: 10px;
	}	
	.itemDetailContent {
		width: 200px;
	}
	.itemDetailPrice {
		font-size: 22px;
		font-weight: 200;
		text-align: right;
		margin-top: 10px;
	}	
	
	.itemType {
		display:none;
	}
	
	.ui-listview .ui-li-has-thumb>img:first-child, .ui-listview .ui-li-has-thumb>.ui-btn>img:first-child, .ui-listview .ui-li-has-thumb .ui-li-thumb {
		max-height: inherit;
		/* -webkit-mask-image: -webkit-gradient(linear, left top, left bottom, from(rgba(0,0,0,1)), to(rgba(0,0,0,0))); */
	}
	
	#popupContact form, #popupNameAddress form, #popupEmail form{
		padding:10px 20px;
	}
	
	#check-content {
		font-family: courier;
		font-size: smaller;
	}
	#email-check {
		background: url("shared/css/images/at.png") no-repeat scroll center 0 rgba(0, 0, 0, 0);
		height: auto;
		padding: 25px;
		text-align: center;
		z-index: 100;
	}

	#email-check a {
		text-decoration: none;
	}

	.ui-footer-fixed {
		height: 46px;
	}
	
	.fb-like, .poweredBy {
		margin-top: 6.25px;
		display:inline-block;
	}
	
	.fb-like {
		float:left;
	}
	
	.poweredBy {
		float: right;
	}
	
	.poweredBy a {
		text-decoration:none;
		font-size: smaller;
	}
	.poweredBy img {
		height:20px;
	}

	/* JQM theme overrides */
	* {
		-webkit-column-rule-color: rgb(0, 0, 0);
		-webkit-text-emphasis-color: rgb(0, 0, 0);
		-webkit-text-fill-color: rgb(0, 0, 0);
		-webkit-text-stroke-color: rgb(0, 0, 0);
		border-bottom-color: rgb(0, 0, 0);
		border-left-color: rgb(0, 0, 0);
		border-right-color: rgb(0, 0, 0);
		border-top-color: rgb(0, 0, 0);
		color: rgb(0, 0, 0);
		outline-color: rgb(0, 0, 0);
	}
	.ui-header, .ui-footer, .ui-popup-container {
		background:white;
	}

	@media only screen 
	and (max-device-width : 568px) 
	and (orientation : portrait) { 
		.ui-content {
			padding-left: 0.25em;
			padding-right: 0.25em;
		}
	}
	</style>
</head>
<body>
<div id="fb-root"></div>
<!-- http://stackoverflow.com/questions/13986182/how-can-i-improve-the-page-transitions-for-my-jquery-mobile-app/13986390#13986390 -->
<div id="allPages" style="visibility:hidden;">
	<div data-role="page" data-theme="d" id="restaurants">
		<div data-role="header" data-id="globalHeader" data-position="fixed">
			<!-- h1><a data-role="button" href="http://www.cookedspecially.com" target="CookedSpecially">CookedSpecially</a></h1 -->
			<div id="options" data-role="controlgroup" data-type="horizontal" data-mini="true">
				<a href="#" data-role="button" data-inline="true" data-icon="home" class="ui-disabled">Restaurants</a>
				<a href="#" data-role="button" data-inline="true" data-icon="info" data-rel="popup" class="ui-disabled">Menus</a>
				<a id="order-button" href="#order" data-role="button" data-inline="true" data-icon="info" class="ui-disabled">My Order</a>
			</div>
		</div>
		<div id="restaurants-content" data-role="content">
			<!--h3>
				Our Family of Restaurants
			</h3-->
		</div>
		<div data-role="footer" data-id="globalFooter" data-position="fixed">
			<div class="fb-like" data-href="https://www.facebook.com/saladdays.co/app_226697114202871" data-layout="standard" data-action="like" data-width="33%" data-max-rows="1" data-show-faces="false" data-share="true"></div>
			<div class="fb-share-button" data-href="https://www.facebook.com/saladdays.co/app_226697114202871" data-width="33%" data-type="button_count"></div>
			<div class="poweredBy"><a target="cs" href="http://www.cookedspecially.com"><img alt="Powered by CookedSpecially" src="/static/assets/shared/images/cs-button.png"/></a></div>
		</div>
	</div>
	
	<div data-role="page" data-theme="d" id="order">
		<div data-role="header" data-id="globalHeader" data-position="fixed">
			<!-- h1><a data-role="button" href="http://www.cookedspecially.com" target="CookedSpecially">CookedSpecially</a></h1 -->
			<div id="options" data-role="controlgroup" data-type="horizontal" data-mini="true">
				<a id="restaurants-button" href="#restaurants" data-role="button" data-inline="true" data-icon="home">Restaurants</a>
				<a href="#" data-role="button" data-inline="true" data-icon="info" data-rel="popup" class="ui-disabled">Menus</a>
				<a href="#" data-role="button" data-inline="true" data-icon="info" class="ui-disabled">My Order</a>
			</div>
		</div>
		<div id="order-content" data-role="content">
		</div>
		<div data-role="footer" data-id="globalFooter" data-position="fixed">
			<div id="options" data-role="controlgroup" data-type="horizontal" data-mini="true">
				<a href="#" onclick="goBack();" data-role="button" data-inline="true" data-icon="back" data-rel="back">Go Back</a>
				<a href="#popupContact" data-role="button" data-inline="true" data-icon="forward" data-rel="popup" data-position-to="window">Place Your Order</a>
			</div>
		</div>
		<div data-role="popup" id="popupContact" data-theme="d" class="ui-corner-all" data-dismissible="false">
			<a href="#" data-rel="back" data-role="button" data-theme="d" data-icon="delete" data-iconpos="notext" class="ui-btn-left">Close</a>
			<form onsubmit="return false;">
				<h3>How may we contact you?</h3>
				<label for="customerEmail" class="ui-hidden-accessible">Email Address</label>
				<input type="email" name="customerEmail" id="customerEmail" value="" placeholder="Email Address" data-theme="d"/>
				<label for="customerPhone" class="ui-hidden-accessible">Telephone Number</label>
				<input type="tel" name="customerPhone" id="customerPhone" value="" placeholder="Telephone Number" data-theme="d"/>
				<!--
				label for="pw" class="ui-hidden-accessible">Password</label>
				<input type="password" name="pass" id="pw" value="" placeholder="password" data-theme="d"/>
				-->
				<fieldset data-role="controlgroup"data-mini="true">
					<input type="radio" data-theme="d" name="radio-choice-takeout-delivery" id="radio-choice-takeout" value="takeout" checked="checked">
					<label for="radio-choice-takeout">Takeout</label>
					<input type="radio" data-theme="d" name="radio-choice-takeout-delivery" id="radio-choice-delivery" value="delivery">
					<label for="radio-choice-delivery">Delivery</label>
				</fieldset>
				<button type="submit" onclick="validateContactInfo();" class="ui-btn ui-corner-all ui-shadow ui-btn-d ui-btn-icon-left ui-icon-check">Continue</button>
			</form>
			<div data-role="content">
				<div class="fb-login-button" data-width="100%" data-max-rows="1" data-show-faces="true">&nbsp;</div>
				<!-- fb:login-button show_faces="true"></fb:login-button -->
				<!-- fb:like send="true" width="450" show_faces="true"></fb:like -->
			</div>
		</div>
		<div data-role="popup" id="popupNameAddress" data-theme="d" class="ui-corner-all" data-dismissible="false">
			<a href="#" data-rel="back" data-role="button" data-theme="d" data-icon="delete" data-iconpos="notext" class="ui-btn-left">Close</a>
			<form onsubmit="return false;">
				<h3>Where should we deliver?</h3>
				<label for="customerName" class="ui-hidden-accessible">Your Name</label>
				<input type="text" name="customerName" id="customerName" value="" placeholder="Your Name" data-theme="d"/>
				<label for="customerAddress1" class="ui-hidden-accessible">Street Address</label>
				<input type="text" name="customerAddress1" id="customerAddress1" value="" placeholder="Street Address" data-theme="d"/>
				<label for="customerAddress2" class="ui-hidden-accessible">City, State ZIP</label>
				<input type="text" name="customerAddress2" id="customerAddress2" value="" placeholder="City, State ZIP" data-theme="d"/>
				<button type="submit" onclick="validateNameAddress();" class="ui-btn ui-corner-all ui-shadow ui-btn-d ui-btn-icon-left ui-icon-check">Continue</button>
			</form>
			<div data-role="content">
				<div class="fb-login-button" data-width="100%" data-max-rows="1" data-show-faces="true">&nbsp;</div>
				<!-- fb:login-button show_faces="true"></fb:login-button -->
				<!-- fb:like send="true" width="450" show_faces="true"></fb:like -->
			</div>
		</div>
	</div>
	
	<div data-role="page" data-theme="d" id="check">
		<div data-role="header" data-id="globalHeader" data-position="fixed">
			<!-- h1><a data-role="button" href="http://www.cookedspecially.com" target="CookedSpecially">CookedSpecially</a></h1 -->
			<div id="options" data-role="controlgroup" data-type="horizontal" data-mini="true">
				<a href="#" data-role="button" data-inline="true" data-icon="home" class="ui-disabled">Restaurants</a>
				<a href="#" data-role="button" data-inline="true" data-icon="info" data-rel="popup" class="ui-disabled">Menus</a>
				<a href="#" data-role="button" data-inline="true" data-icon="info" class="ui-disabled">My Order</a>
			</div>
		</div>
		<div id="check-content" data-role="content">
		</div>
		<!--div id="email-check" data-role="content">
			<a href="#popupEmail" data-rel="popup" onclick="">Email Check</a>
		</div-->
		<div data-role="footer" data-id="globalFooter" data-position="fixed">
			<div id="options" data-role="controlgroup" data-type="horizontal" data-mini="true">
				<a id="done-button" href="#" onclick="reset();" data-role="button" data-inline="true" data-icon="home">Done</a>
				<a id="emailcheck-button" href="#popupEmail" data-rel="popup" data-role="button" data-inline="true" data-icon="check" data-position-to="window">Email Check</a>
			</div>
		</div>
		<div data-role="popup" id="popupEmail" data-theme="d" class="ui-corner-all" data-dismissible="false">
			<a href="#" data-rel="back" data-role="button" data-theme="d" data-icon="delete" data-iconpos="notext" class="ui-btn-left">Close</a>
			<form onsubmit="return false;">
				<h3>Please let us know your email address.</h3>
				<label for="customerEmail" class="ui-hidden-accessible">Email Address</label>
				<input type="email" name="customerEmail" id="customerEmail" value="" placeholder="Email Address" data-theme="d"/>
				<!--
				label for="pw" class="ui-hidden-accessible">Password</label>
				<input type="password" name="pass" id="pw" value="" placeholder="password" data-theme="d"/>
				-->
				<button type="submit" onclick="validateEmailForCheck();" class="ui-btn ui-corner-all ui-shadow ui-btn-d ui-btn-icon-left ui-icon-check">Continue</button>
			</form>
		</div>
	</div>
</div>
<!-- End allPages -->

<script type="text/javascript" charset="utf-8">
try {
/**********
 * CONSTANTS
 */
var debug = true;
var appVersion = '1.9.6';
var appLatestVersion = '1.9.6';

var restaurantId = "1"; //Axis
/**********
 * CONSTANTS
 */
var comCookedSpeciallyImagePattern = /\/static\/\d+\//;
var comCookedSpeciallyImagePrefix = "";
var comCookedSpeciallyApiPrefix = "/CookedSpecially";

var mediaWidth = (window.innerWidth > 0) ? window.innerWidth : screen.width;
var isPhone = (window.matchMedia('(max-device-width: 568px)').matches);

// temporary hack
var serverName = location.hostname + ":" + location.port;

var db;
var strConnectionAlert = "You appear to be online, but we have a connection problem. Please click Ok to try to download today's menu again.";
var strOfflineAlert = "You appear to be offline. Please go online and click Ok to download today's menu.";

var changeCount = 0;
var menuCount = 0;

/* *********
 * GLOBALS
 */
var globalMenuIndex = 0; // counter to see if we even have more that one menu at all
var initialHash = "#restaurants";
var initialURL = window.location.protocol + "//" + window.location.host + window.location.pathname + window.location.search;
var restaurantsParamMatch = /\[[0-9,]+?\]/;
var customerInfo = {};
var customerId = "";
var customerEmail = "";
var customerPhone = "";
var emailMatch = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$/;
var phoneMatch = /^[0-9.-]+$/;
var phoneClean = /[.-]/g;
var custIdParam = "";
var restaurants = [1,8];
var restaurantDataString = "";
var restaurantData = [];
var globalDataString = "";
var globalData = [];
var startTime;
var endTime;
var loadingTime;
// Preloading images -- http://engineeredweb.com/blog/09/12/preloading-images-jquery-and-javascript/
var preloadCache = [];
var currency = '&#x20B9;'; // Indian rupee (&#x20B9;)
var orderItemCount = 0;
var orderItemCountArray = [];
var myHistory = [];
var checks = {1:null, 8:null};

// APIs
var _getTables  = '/CookedSpecially/seatingTable/getRestaurantTables.json?', 
    _setTable   = '/CookedSpecially/seatingTable/setStatus?', 
    _custInfo   = '/CookedSpecially/customer/getCustomerInfo.json?', 
    _setCustInfo   = '/CookedSpecially/customer/setCustomerInfo.json?', 
    _getCheck   = '/CookedSpecially/order/getCheckWithOrders.json?', 
    _addToCheck = '/CookedSpecially/order/addToCheck.json?', 
    _emailCheck = '/CookedSpecially/order/emailCheck?';	

var searchParam = decodeURIComponent(window.location.search).substring(1);
if (restaurantsParamMatch.test(searchParam)) {
	restaurantsParamJson = JSON.parse('{"restaurants":' + restaurantsParamMatch.exec(searchParam) + '}');
	restaurants = restaurantsParamJson.restaurants;
}

// Avoid `console` errors in browsers that lack a console.
// http://stackoverflow.com/questions/7585351/testing-for-console-log-statements-in-ie
(function() {
    var method;
    var noop = function () {};
    var methods = [
        'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',
        'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',
        'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',
        'timeStamp', 'trace', 'warn'
    ];
    var length = methods.length;
    var console = (window.console = window.console || {});

    while (length--) {
        method = methods[length];

        // Only stub undefined methods.
        if (!console[method]) {
            console[method] = noop;
        }
    }
}());

/* **********
 * 1. BEGIN initHomePage
 * Iterates through all menus in data file and add menus to the home page
   Function Calls 
    - addMenuToHomePage() for each menu
    - updateAllMenus()
 */
function initHomePage(restaurantId, restaurantName) {
        //debugLog("DEBUG > BEGIN initHomePage");    
        //debugLog("DEBUG > About to iterate through globalData");

        if (globalData[restaurantId] != null && typeof(globalData[restaurantId].menus != "undefined") && globalData[restaurantId].menus != null) {
			// special-case the lonely menu situation
			if (restaurants.length == 1 && globalData[restaurantId].menus.length == 1) {
				initialHash = "#menu" + globalData[restaurantId].menus[0].menuId;
				updateMenuPage(restaurantId, restaurantName, 0);
				$("#restaurants").on( "pagebeforeshow", function(event, ui) {
					// do something before navigating to a new page
					if (initialHash != "#restaurants") {
						// deprecated in 1.4
						// $.mobile.changePage(initialHash, { changeHash: true });
						$.mobile.pageContainer.pagecontainer ("change", initialHash, {changeHash: true});
					}
				});
				$("#restaurants").on( "pageshow", function(event, ui) {
					// do something before navigating to a new page
					if (initialHash != "#restaurants") {
						// deprecated in 1.4
						// $.mobile.changePage(initialHash, { changeHash: true });
						$.mobile.pageContainer.pagecontainer ("change", initialHash, {changeHash: true});
					}
				});
				$("a#restaurants-button").addClass("ui-disabled");
				$("a#menu-button").addClass("ui-disabled");
				// deprecated in 1.4
				// $.mobile.changePage(initialHash, { changeHash: true });
				$.mobile.pageContainer.pagecontainer ("change", initialHash, {changeHash: true});
			}
			// general logic that allows for multiple restaurants and multiple menus
			else {
				var theRestaurant = $("div#restaurants div div#restaurant" + restaurantId);
				var theRestaurantOrder = $("div#order div div#restaurant" + restaurantId);
				var theMenuUl = $("div#restaurants div div#restaurant" + restaurantId + " ul");
				var theMenuOrderUl = $("div#order div div#restaurant" + restaurantId + " ul");

				if (theMenuUl.hasClass('ui-listview')) {
					theMenuUl.listview('refresh');
					debugLog("Refreshing list.");
				} else {
					theMenuUl.listview();
					debugLog("Creating list.");
				}

				// iterate through data file and create menus in homepage
				var menuIndex = 0;
				$.each(globalData[restaurantId].menus, function() {
					if (typeof(globalData[restaurantId].menus[menuIndex].menuId) != "undefined" && globalData[restaurantId].menus[menuIndex].menuId != null) {
						addMenuToHomePage(restaurantId, menuIndex);
						updateMenuPage(restaurantId, restaurantName, menuIndex);
						menuIndex++;
					}
				});
		
				if (theMenuUl.hasClass('ui-listview')) {
					debugLog("Refreshing list.");
					theMenuUl.listview('refresh');
				} else {
					debugLog("Creating list.");
					theMenuUl.listview();
				}
		
				if (theRestaurant.hasClass('ui-collapsible')) {
					debugLog("Refreshing collapsible.");
					//theMenuUl.parent().collapsible('refresh');
				} else {
					debugLog("Creating collapsible.");
					theRestaurant.collapsible();
					// worked in jqm 1.3.2, not in 1.4
					//theRestaurant.trigger('expand');
				}
		
				$(theRestaurant).show();
				menuIndex = 0;
				$.each(globalData[restaurantId].menus, function() {
					// create each menu page
					addMenuLinksToControlGroup(restaurantId, menuIndex);
					menuIndex++;
				});				
			}
        }
        else {
                //debugLog("DEBUG > globalData invalid");
        }
        
		$("#allPages").css({ "visibility": "visible" });
		$.mobile.loading( "hide" );
				
        //debugLog("DEBUG > END initHomePage");      
}
/* 
 * END initHomePage
 **********/

 
 

/* 
 *******************************************************
                     UI FUNCTIONS
 ******************************************************* 
 */
 
/* **********
 * 2. BEGIN addMenuToHomePage
 * Creates the home page with all the menus
    Parameters: 
    m - menu index 
 */
function addMenuToHomePage(restaurantId, m) {
        //console.info("DEBUG > BEGIN addMenuToHomePage: " + globalData[restaurantId].menus[m].name); 

    var menuId = globalData[restaurantId].menus[m].menuId;
    var name = globalData[restaurantId].menus[m].name;
    var imageUrl = globalData[restaurantId].menus[m].imageUrl;
        
        var theMenuLi =	'<li data-corners="false" data-shadow="false" data-iconshadow="true" data-wrapperels="div" data-icon="arrow-r" data-iconpos="right" data-theme="c" class="ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-first-child ui-btn-up-c">' +
						'	<div class="ui-btn-inner ui-li">' + 
						'		<div class="ui-btn-text">' + 
						'			<a href="#menu' + menuId + '" class="ui-link-inherit">' + name + '</a>' + 
						'		</div>' + 
						'		<span class="ui-icon ui-icon-arrow-r ui-icon-shadow">&nbsp;</span>' + 
						'	</div>' + 
						'</li>'; 
		var theMenuLiHtml = '<li id="menu' + menuId + '"><a href="#menu' + menuId + '">' + name + '</a></li>';
		$(theMenuLiHtml).appendTo("div#restaurants div div#restaurant" + restaurantId + " ul");
		var theMenuLi = $("div#restaurants div div#restaurant" + restaurantId + " ul li#menu" + menuId);

		/*
		if (imageUrl.length != 0) {
				var menuSelector = "a#menu" + menuId;
				var imageUrl = "url(" + comCookedSpeciallyImagePrefix + imageUrl + ")";
				$(menuSelector).css({"background-image": imageUrl, "background-size": "cover"});
		}
        */
        
        //debugLog("DEBUG > END addMenuToHomePage"); 
}
/* 
 * END addMenuToHomePage
 **********/
 
 
/* **********
 * 3. BEGIN updateMenuPage
 * Create each menu page
    Parameters: 
    m - menu index 
 */
 function updateMenuPage(restaurantId, restaurantName, m) {
        //console.info("DEBUG > BEGIN updateMenuPage: " + m);   

        if (typeof(globalData[restaurantId].menus[m].menuId) != "undefined" && globalData[restaurantId].menus[m].menuId != null) {
                var menuId = "menu" + globalData[restaurantId].menus[m].menuId;
                var smallImageUrl = "";
                if (typeof(globalData[restaurantId].menus[m].smallImageUrl) != "undefined" && globalData[restaurantId].menus[m].smallImageUrl != null) {
                        smallImageUrl = globalData[restaurantId].menus[m].smallImageUrl;
                }               
                var modifiedTime = new Date(globalData[restaurantId].menus[m].modifiedTime);
                var sectionId = "";
                
                // Create menu page container
                addMenuPage(restaurantId, restaurantName, m);

                // iterate through each section
                var s = 0;
                $.each(globalData[restaurantId].menus[m].sections, function() {
                        if (typeof(sectionId) != "undefined" && sectionId != null && sectionId.length == 0) {
                                sectionId = "section" + this.sectionId;
                        }
                        // Create section container
                        addSectionToMenuPage(restaurantId, restaurantName, m, s);
                        s++;
                });
                
                $("#menu" + menuId + "-sections").collapsible();
                $("#menu" + menuId + "-sections").trigger('expand');
        
        }else {
                debugLog("updateMenuPage: menuId undefined");
        }
        //debugLog("DEBUG > END updateMenuPage");    
}

/* **********
 * 4 BEGIN addMenuLinksToControlGroup
 * Create each menu page
    Parameters: 
    m - menu index 
 */
 function addMenuLinksToControlGroup(restaurantId, m) {
        //console.info("DEBUG > BEGIN addMenuLinksToControlGroup: " + m);   

        if (typeof(globalData[restaurantId].menus[m].menuId) != "undefined" && globalData[restaurantId].menus[m].menuId != null) {
                var menuId = "menu" + globalData[restaurantId].menus[m].menuId;
				var menuName = globalData[restaurantId].menus[m].name;

				var theMenuItems = $("div#restaurants div#restaurant" + restaurantId + " ul").html();
				$(theMenuItems).appendTo('div#' + menuId + ' ul#' + menuId + '-menu-nav-list');
                $('div#' + menuId + ' ul#' + menuId + '-menu-nav-list li#' + menuId + ' a').addClass("ui-disabled");

        }else {
                debugLog("updateMenuPage: menuId undefined");
        }
        //debugLog("DEBUG > END updateMenuPage");    
}

/* 
 * END addMenuLinksToControlGroup
 **********/
 
 


/* **********
 * BEGIN addMenuPage
 * Creates page container for each menu
   Parameters: 
    i - menu index 
 */
//function addMenuPage(menuId, name, description) {
function addMenuPage(restaurantId, restaurantName, m) {
        //console.info("DEBUG > BEGIN addMenuPage: " + m );
        var menuId = globalData[restaurantId].menus[m].menuId;
		var menuName = globalData[restaurantId].menus[m].name;
		var menuDescription = globalData[restaurantId].menus[m].description;
        var thePage = '' + 
'	<div data-role="page" data-theme="d" id="menu' + menuId + '">' + 
'		<div data-role="header" data-id="globalHeader" data-position="fixed">' + 
'			<div id="options" data-role="controlgroup" data-type="horizontal" data-mini="true">' + 
'				<a id="restaurants-button" href="#restaurants" data-role="button" data-inline="true" data-icon="home">Restaurants</a>' + 
'				<a id="menu-button" href="#menu' + menuId + '-menu-nav" data-role="button" data-inline="true" data-icon="info" data-rel="popup">Menus</a>' + 
'				<a id="order-button" href="#order" data-role="button" data-inline="true" data-icon="info" class="ui-disabled">My Order</a>' + 
'			</div>' + 
'		</div>' + 
'		<div id="menu-content" data-role="content">' + 
'			<div id="menu' + menuId + '-sections">' + 
'			</div>' + 
'		</div>' + 
'		<div data-role="footer" data-id="globalFooter" data-position="fixed">' + 
'			<div class="fb-like" data-href="http://www.cookedspecially.com" data-layout="standard" data-action="like" data-width="50%" data-max-rows="1" data-show-faces="false" data-share="true"></div>' + 
'			<div class="poweredBy"><a target="cs" href="//www.cookedspecially.com"><img alt="Powered by CookedSpecially" src="/static/assets/shared/images/cs-button.png"/></a></div>' + 
'		</div>' + 
'		<div data-role="popup" id="menu' + menuId + '-menu-nav" data-overlay-theme="d">' + 
'			<div data-role="content">' + 
'				<ul id="menu' + menuId + '-menu-nav-list" data-role="listview">' + 
'				</ul>' + 
'			</div>' + 
'		</div>' + 
'	</div>';

        if ($("div#menu" + menuId).length == 0) {
                $(thePage).appendTo($.mobile.pageContainer);
        }else {
                //debugLog("DEBUG > Skipping menu page " + globalData[restaurantId].menus[m].name + "because it has already been added");
        }

        //debugLog("DEBUG > END addMenuPage");       
}
/* 
 * END addMenuPage
 **********/
 
 
 
  
 /* **********
 * BEGIN addSectionToMenuPage
 * Creates sections and filter links for each menu page
   Parameters: 
    m - menu index 
    s - section index
 */ 
function addSectionToMenuPage(restaurantId, restaurantName, m, s) {
        //console.info("DEBUG > addSectionToMenuPage() >  Menu: " + m + " Section: " + s);      
        
        if (typeof(globalData[restaurantId].menus[m].sections[s].sectionId) != "undefined" && globalData[restaurantId].menus[m].sections[s].sectionId != null) {
                var name = globalData[restaurantId].menus[m].sections[s].name;
                var menuId = globalData[restaurantId].menus[m].menuId;
				var menuName = globalData[restaurantId].menus[m].name;
                var sectionId = globalData[restaurantId].menus[m].sections[s].sectionId;
                
                var theHtml = '' + 
'				<h3 id="section' + sectionId + '">' + 
'					<span class="breadcrumb">' + restaurantName + ' / ' + menuName + ' / </span><br/>' + name + '' + 
'				</h3>' + 
'				<ul id="section' + sectionId + '" data-role="listview" data-inset="true" data-filter="false">' + 
'				</ul>' + 
'				<br>';
				
				$(theHtml).appendTo("#menu" +  menuId + "-sections");
				
				var theSectionUl = $("ul#section" + sectionId);

                // iterate through each item
                var itemIndex = 0;
                $.each(globalData[restaurantId].menus[m].sections[s].items, function() {
                        addItemToMenuPage(restaurantId, m,s,itemIndex);
                        addItemDetailPage(restaurantId, m,s,itemIndex);
                        itemIndex++;
                });
                
        }       
        //debugLog("DEBUG > END addSectionToMenuPage");      
}
/* 
 * END addSectionToMenuPage
 **********/
 
 

 
 


/* **********
 * BEGIN addItemToMenuPage
 * Populates menu page containers
    Parameters: 
    m - menu index 
    s - section index
    i - item index
 */
function addItemToMenuPage(restaurantId, m,s,i) {
        //console.info ("DEBUG > BEGIN addItemToMenuPage" );    

        var menuId = "menu" + globalData[restaurantId].menus[m].menuId;
        var sectionId = "section" + globalData[restaurantId].menus[m].sections[s].sectionId;
        var item = globalData[restaurantId].menus[m].sections[s].items[i];
        
        
        if (typeof(item.itemId) != "undefined" && item.itemId != null) {
                var itemId = "item" + item.itemId;
                var name = item.name;
                var description = item.description;
                var shortDescription = item.shortDescription;
                var price = item.price;
                var itemType = item.itemType;
                var vegetarian = item.vegetarian ? '<div class="vegetarian"></div>' : '';
                var alcoholic = item.alcoholic;
                var imageUrl = "";
                var smallImageUrl = "";
                
                
                // cache images
                /*
                 * This design doesn't use the full-size images
                 *
                if (typeof(item.imageUrl) != "undefined") {
                    imageUrl = item.imageUrl;
                }
                else {
                	imageUrl = "/static/assets/shared/images/defaultDetail50Percent.png"
                }
				var fullImageUrl = comCookedSpeciallyImagePrefix + imageUrl;
				var cacheImage = document.createElement('img');
				cacheImage.src = fullImageUrl;
				preloadCache.push(cacheImage);
				*/
                if (typeof(item.smallImageUrl) != "undefined" && item.smallImageUrl != null) {
					smallImageUrl = item.smallImageUrl;
                }
                else {
                	smallImageUrl = "/static/assets/shared/images/defaultDetail50Percent200x200.png"
                }
				var fullsmallImageUrl = comCookedSpeciallyImagePrefix + smallImageUrl;
				var cacheImage = document.createElement('img');
				cacheImage.src = fullsmallImageUrl;
				preloadCache.push(cacheImage);
				var popup = 'data-rel="popup" data-position-to="window"';
				if (isPhone) {
					popup = '';
				}
                var theItem = '' + 
'					<li id="' + itemId + '">' + 
'					<a href="#' + itemId + 'detail" data-icon="info" ' + popup + '>' + 
'					<img src="' + smallImageUrl + '">' + 
'					<div class="itemContent">' +
'					    <div class="title">' + vegetarian + name + ' <img class="icon-info" src="data:image/svg+xml;charset=US-ASCII,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22iso-8859-1%22%3F%3E%3C!DOCTYPE%20svg%20PUBLIC%20%22-%2F%2FW3C%2F%2FDTD%20SVG%201.1%2F%2FEN%22%20%22http%3A%2F%2Fwww.w3.org%2FGraphics%2FSVG%2F1.1%2FDTD%2Fsvg11.dtd%22%3E%3Csvg%20version%3D%221.1%22%20id%3D%22Layer_1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20x%3D%220px%22%20y%3D%220px%22%20%20width%3D%2214px%22%20height%3D%2214px%22%20viewBox%3D%220%200%2014%2014%22%20style%3D%22enable-background%3Anew%200%200%2014%2014%3B%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20d%3D%22M7%2C0C3.134%2C0%2C0%2C3.134%2C0%2C7s3.134%2C7%2C7%2C7s7-3.134%2C7-7S10.866%2C0%2C7%2C0z%20M7%2C2c0.552%2C0%2C1%2C0.447%2C1%2C1S7.552%2C4%2C7%2C4S6%2C3.553%2C6%2C3%20S6.448%2C2%2C7%2C2z%20M9%2C11H5v-1h1V6H5V5h3v5h1V11z%22%2F%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3Cg%3E%3C%2Fg%3E%3C%2Fsvg%3E"/></div>' +
'					    <div class="description">' + shortDescription + '</div>' +
'					    <div class="price">' + currency + price + '</div>' + 
'					    <div class="itemType" style="display:none">' + itemType + '</div>' +
'					    <!-- span class="ui-li-count">' + currency + price + '</span -->' + 
'					</div>' +
'					</a>' + 
'					<a href="#" onclick="addItemToOrder(' + restaurantId + ',' + m + ',' + s + ',' + i + ');" data-icon="plus">Add to My Order</a>' + 
'					</li>';

				var theSectionUl = $("ul#" + sectionId);
                $(theItem).appendTo(theSectionUl);

        }
        //debugLog("DEBUG > END addItemToMenuPage"); 
}
/* 
 * END addItemToMenuPage
 **********/


 
/* **********
 * BEGIN addItemDetailPage
 * Creates menu item popup pages
    Parameters: 
    m - menu index 
    s - section index
    i - item index
 */
function addItemDetailPage(restaurantId, m,s,i) {
        //console.info ("DEBUG > BEGIN addItemDetailPage" );    

        var menuId = "menu" + globalData[restaurantId].menus[m].menuId;
        var sectionId = "section" + globalData[restaurantId].menus[m].sections[s].sectionId;
        var item = globalData[restaurantId].menus[m].sections[s].items[i];
        
        
        if (typeof(item.itemId) != "undefined" && item.itemId != null) {
                var itemId = "item" + item.itemId;
                var name = item.name;
                var description = item.description;
                var shortDescription = item.shortDescription;
                var price = item.price;
                var itemType = item.itemType;
                var vegetarian = item.vegetarian ? '<div class="vegetarian"></div>' : '';
                var alcoholic = item.alcoholic;
                var imageUrl = "";
                var smallImageUrl = "";
                
				if (description.length == 0) {
					description = shortDescription;
				}
		
                // cache images
                /*
                 * This design doesn't use the full-size images
                 *
                if (typeof(item.imageUrl) != "undefined") {
                    imageUrl = item.imageUrl;
                }
                else {
                	imageUrl = "/static/assets/shared/images/defaultDetail50Percent.png"
                }
				var fullImageUrl = comCookedSpeciallyImagePrefix + imageUrl;
				var cacheImage = document.createElement('img');
				cacheImage.src = fullImageUrl;
				preloadCache.push(cacheImage);
				*/
                if (typeof(item.smallImageUrl) != "undefined" && item.smallImageUrl != null) {
					smallImageUrl = item.smallImageUrl;
                }
                else {
                	smallImageUrl = "/static/assets/shared/images/defaultDetail50Percent200x200.png"
                }
				var fullsmallImageUrl = comCookedSpeciallyImagePrefix + smallImageUrl;
				var cacheImage = document.createElement('img');
				cacheImage.src = fullsmallImageUrl;
				preloadCache.push(cacheImage);
				var popup = 'data-role="popup"';
				if (isPhone) {
					popup = 'data-role="page"';
				}

				var header = '<a href="#" data-rel="back" data-role="button" data-theme="d" data-icon="delete" data-iconpos="notext" class="ui-btn-left">Close</a>';
				if (isPhone) header = '' + 
'					<div data-role="header" data-id="globalHeader" data-position="fixed">' + 
'						<!-- h1><a data-role="button" href="http://www.cookedspecially.com" target="CookedSpecially">CookedSpecially</a></h1 -->' + 
'						<div id="options" data-role="controlgroup" data-type="horizontal" data-mini="true">' + 
'							<a id="restaurants-button" href="#restaurants" data-role="button" data-inline="true" data-icon="home">Restaurants</a>' + 
'							<a id="menu-button" href="#" data-role="button" data-inline="true" data-icon="info" data-rel="popup" class="ui-disabled">Menus</a>' + 
'							<a id="order-button" href="#order" data-role="button" data-inline="true" data-icon="info" class="ui-disabled">My Order</a>' + 
'						</div>' + 
'					</div>';

				var footer = '' + 
'						<div data-role="content">' + 
'							<div id="options" data-role="controlgroup" data-type="horizontal" data-mini="true">' + 
'								<a href="#" onclick="goBack();" data-role="button" data-inline="true" data-icon="back" data-rel="back">Go Back</a>' + 
'								<a href="#" onclick="addItemToOrder(' + restaurantId + ',' + m + ',' + s + ',' + i + ');" data-role="button" data-inline="true" data-icon="plus">Add To Order</a>' + 
'							</div>' + 
'						</div>';
				if (isPhone) footer = '' + 
'						<div data-role="footer" data-id="globalFooter" data-position="fixed">' + 
'							<div id="options" data-role="controlgroup" data-type="horizontal" data-mini="true">' + 
'								<a href="#" onclick="goBack();" data-role="button" data-inline="true" data-icon="back" data-rel="back">Go Back</a>' + 
'								<a href="#" onclick="addItemToOrder(' + restaurantId + ',' + m + ',' + s + ',' + i + ');" data-role="button" data-inline="true" data-icon="plus">Add To Order</a>' + 
'							</div>' + 
'						</div>';

                var theItem = '' + 
'					<div ' + popup + ' id="' + itemId + 'detail" class="itemDetail" data-overlay-theme="a">' + 
header + 
'						<div class="itemDetailContent" data-role="content">' + 
'							<img width="200px" src="' + fullsmallImageUrl + '"/>' + 
'							<h3 class="itemDetailName">' + 
'								' + vegetarian + name + ' ' + 
'							</h3>' + 
'							<div class="itemDetailDesc">' + 
'								' + description + ' ' + 
'							</div>' + 
'							<div class="itemDetailPrice">' + 
'								' + currency + price + ' ' + 
'							</div>' + 
'						</div>' + 
footer + 
'					</div>';

				if (isPhone) {
					$(theItem).appendTo($.mobile.pageContainer);
				}
				else {
                	$(theItem).appendTo("div#allPages div#" + menuId);
                }
        }
        //debugLog("DEBUG > END addItemDetailPage"); 
}
/* 
 * END addItemDetailPage
 **********/

/* **********
 * BEGIN addItemToOrder
 * Adds an item to the Order page
    Parameters: 
    m - menu index 
    s - section index
    i - item index
 */
function addItemToOrder(restaurantId, m,s,i) {
	//console.info ("DEBUG > BEGIN addItemToOrder" );    
	$.mobile.loading( "show", {
		text: "Adding to Orderâ€¦",
		textVisible: true,
		theme: $.mobile.loader.prototype.options.theme,
		textonly: false,
		html: ""
	});
	$("a#order-button").addClass("achtung");
	var menuId = "menu" + globalData[restaurantId].menus[m].menuId;
	var sectionId = "section" + globalData[restaurantId].menus[m].sections[s].sectionId;
	var item = globalData[restaurantId].menus[m].sections[s].items[i];
	var itemId = item.itemId;
	var htmlItemId = "item" + item.itemId;
	var name = item.name;
	var description = item.description;
	var shortDescription = item.shortDescription;
	var price = item.price;
	var itemType = item.itemType;
	var vegetarian = item.vegetarian ? '<div class="vegetarian"></div>' : '';
	var alcoholic = item.alcoholic;
	var imageUrl = "";
	var smallImageUrl = "";
	
	if (description.length == 0) {
		description = shortDescription;
	}
	
	// cache images
	/*
	 * This design doesn't use the full-size images
	 *
	if (typeof(item.imageUrl) != "undefined") {
		imageUrl = item.imageUrl;
	}
	else {
		imageUrl = "/static/assets/shared/images/defaultDetail50Percent.png"
	}
	var fullImageUrl = comCookedSpeciallyImagePrefix + imageUrl;
	var cacheImage = document.createElement('img');
	cacheImage.src = fullImageUrl;
	preloadCache.push(cacheImage);
	*/
	if (typeof(item.smallImageUrl) != "undefined" && item.smallImageUrl != null) {
		smallImageUrl = item.smallImageUrl;
	}
	else {
		smallImageUrl = "/static/assets/shared/images/defaultDetail50Percent200x200.png"
	}
	var fullsmallImageUrl = comCookedSpeciallyImagePrefix + smallImageUrl;
	var cacheImage = document.createElement('img');
	cacheImage.src = fullsmallImageUrl;
	preloadCache.push(cacheImage);

    
    var theItem = '' + 
'		<li id="order-' + htmlItemId + '">' + 
'		<a class="item" href="#">' + 
'			<img src="' + smallImageUrl + '">' + 
'		<div class="itemContent ">' +
'		    <div id="title" class="title">' + vegetarian + name + ' </div>' +
'		    <div id="description" class="description">' + shortDescription + '</div>' +
'			<div class="price">' + currency + '<span id="price">' + price + '</span></div>' + 
'			<div class="itemType" style="display:none">' + itemType + '</div>' + 
'			<div id="restaurantId" style="display:none">' + restaurantId + '</div>' + 
'			<div id="menuId" style="display:none">' + m + '</div>' + 
'			<div id="sectionId" style="display:none">' + s + '</div>' + 
'			<div id="itemId" style="display:none">' + itemId + '</div>' + 
'			<!-- span class="ui-li-count">' + currency + price + '</span -->' + 
'		</div>' +
'		</a>' + 
'		<a href="#" onclick="removeItemFromOrder($(this).parent(),' + restaurantId + ',' + m + ',' + s + ',' + i + ');" data-icon="delete">Remove</a>' + 
'		<!-- a href="#" onclick="$(this).parent().remove();" data-icon="delete">Remove</a -->' + 
'		</li>';
    var theMenuOrderUl = $("div#order-content div#restaurant" + restaurantId + " ul");
    var theCollapsible = $("div#order-content div#restaurant" + restaurantId);
    $(theCollapsible).show();
	$(theItem).prependTo(theMenuOrderUl);
	
	if (theMenuOrderUl.hasClass('ui-listview')) {
		debugLog("Refreshing list.");
		theMenuOrderUl.listview('refresh');
	} else {
		debugLog("Creating list.");
		theMenuOrderUl.listview();
	}

	if (theCollapsible.hasClass('ui-collapsible')) {
		debugLog("Refreshing collapsible.");
		theCollapsible.collapsible('refresh');
	} else {
		debugLog("Creating collapsible.");
		theCollapsible.collapsible();
		theCollapsible.trigger('expand');
	}
	
	$(theCollapsible).show();
	$("a#order-button").removeClass("ui-disabled");
	if (isPhone) {
		//history.back();
	}
	else {
		//$( "#" + itemId + "detail" ).popup( "close" );
	}
	orderItemCount++;
	orderItemCountArray[restaurantId]++;

	setTimeout(function(){$.mobile.loading( "hide" );$("a#order-button").removeClass("achtung");},1000);
	//debugLog("DEBUG > END addItemToOrder"); 
}
/* 
 * END addItemToOrder
 **********/

/* **********
 * BEGIN removeItemFromOrder
 * Adds an item to the Order page
    Parameters: 
    m - menu index 
    s - section index
    i - item index
 */
function removeItemFromOrder(listItem, restaurantId, m,s,i) {
	//console.info ("DEBUG > BEGIN removeItemFromOrder" );    

	listItem.remove();

	orderItemCount--;
	orderItemCountArray[restaurantId]--;
	
	updateOrderTotals();

	if (orderItemCountArray[restaurantId] < 1) {
		var theCollapsible = $("div#order-content div#restaurant" + restaurantId);
		theCollapsible.hide();
    }
	if (orderItemCount < 1) {
		$("a#order-button").addClass("ui-disabled");
		history.back();
    }
	//debugLog("DEBUG > END removeItemFromOrder"); 
}
/* 
 * END removeItemFromOrder
 **********/

/* **********
 * BEGIN updateOrderTotals
 * 
 */
function updateOrderTotals() {
	//console.info ("DEBUG > BEGIN updateOrderTotals" );    

	$.each(restaurants, function() {
		var total = 0;
		$.each($("#order #order-content #restaurant" + this + " span#price"), function() {
			total = total + Number($(this).text());
		});
		$("#order #order-content #restaurant" + this + " h3 a span.ui-li-count").html(currency + total.toFixed(2) + " + Tax");
	});

	//debugLog("DEBUG > END updateOrderTotals"); 
}
/* 
 * END updateOrderTotals
 **********/

/* **********
 * BEGIN goBack
 * 
 */
function goBack() {
	//console.info ("DEBUG > BEGIN goBack" );    
	
	document.location = myHistory[myHistory.length -1];
	/*
	history.go(-1);
	navigator.app.backHistory();
	$(window).on('hashchange', function() {});
	*/
	//debugLog("DEBUG > END goBack"); 
}
/* 
 * END goBack
 **********/

/* **********
 * BEGIN validateContactInfo
 * 
 */
function validateContactInfo() {
	//console.info ("DEBUG > BEGIN validateContactInfo" );    
	
	custIdParam = "";
	customerEmail = $("#popupContact input#customerEmail").val().trim().toLowerCase();
	customerPhone = $("#popupContact input#customerPhone").val().trim().toLowerCase();

	if (emailMatch.test(customerEmail)) {
		custIdParam = "&email=" + customerEmail;
		$("input#customerEmail").val(customerEmail);
	}
	else if (phoneMatch.test(customerPhone)) {
		custIdParam = "&phone=" + customerPhone.replace(phoneClean,"");
	}

	if (custIdParam.length != "") {
		$("input#customerEmail").parent().removeClass("achtung");
		$("input#customerPhone").parent().removeClass("achtung");

		//  /customer/getCustomerInfo.json?custId=<uniquedatabaseId>&email=<emailaddress>&phone=<phonenum>
		var custInfoUrl = _custInfo + custIdParam;
		$.ajax({
		  url: custInfoUrl,
		  dataType: 'json'
		})
		.done (function (data) {
			if (data.customers[0].customerId > 0) {
				customerInfo = data.customers[0];
				customerId = data.customers[0].customerId;
				populateFormsFromCustomerInfo();
				if ($("#radio-choice-delivery").prop("checked")) {
					$( "#popupContact" ).popup( "close" );
					setTimeout( function(){ $( "#popupNameAddress"  ).popup( 'open' ) }, 100 );
				}
				else {
					// Make sure we can't go back to the order page we're leaving now.
					myHistory.pop();
					history.replaceState({}, "CookedSpecially", initialHash);
					// deprecated in 1.4
					// $.mobile.changePage('#check', { changeHash: true });
					$.mobile.pageContainer.pagecontainer ("change", '#check', {changeHash: true});
					
					$.each(restaurants, function() {
						placeOrder(this, customerId, "TAKEAWAY");
					});
				}
			}
		})
		.fail(function() { 
			debugLog("AJAX: get customer info FAILED. " + custInfoUrl); 
		})
		.always(function() { 
			debugLog("AJAX: get customer info COMPLETED"); 
		});
	}
	else {
		$("input#customerEmail").parent().addClass("achtung");
		$("input#customerPhone").parent().addClass("achtung");
	}
	
	return false;
	//debugLog("DEBUG > END validateContactInfo"); 
}
/* 
 * END validateContactInfo
 **********/

/* **********
 * BEGIN validateNameAddress
 * 
 */
function validateNameAddress() {
	//console.info ("DEBUG > BEGIN validateNameAddress" );    
	
	var customerName = $("input#customerName").val().trim();
	var customerAddress1 = $("input#customerAddress1").val().trim();
	var customerAddress2 = $("input#customerAddress2").val().trim();

	if (customerName == "") {
		$("input#customerName").parent().addClass("achtung");
		return false;
	}
	if (customerAddress1 == "") {
		$("input#customerAddress1").parent().addClass("achtung");
		return false;
	}
	if (customerAddress2 == "") {
		$("input#customerAddress2").parent().addClass("achtung");
		return false;
	}
	
	// dunno what to validate here; probably display a confirmation popup before progressing
	if (true) {
		$("input#customerName").parent().removeClass("achtung");
		$("input#customerAddress1").parent().removeClass("achtung");
		$("input#customerAddress2").parent().removeClass("achtung");
		
		// Update customer info
		customerInfo.firstName = customerName.split(' ').slice(0, -1).join(' ');
		customerInfo.lastName = customerName.split(' ').slice(-1).join(' ');
		customerInfo.address = customerAddress1;
		customerInfo.city = customerAddress2;
		customerInfo.email = customerEmail;
		customerInfo.phone = customerPhone;
		delete customerInfo.restaurantId;
		delete customerInfo.userId;
		delete customerInfo.numberOfOrders;
		delete customerInfo.createdTime;
		
		var jsonString = JSON.stringify(customerInfo);
		
		$.ajax({
			type: "POST",
			contentType:"application/json; charset=utf-8",
			url: _setCustInfo,
			data: jsonString
		})
		.done (function (data) {
			debugLog("AJAX: customerUpdate SUCCEEDED. " + _setCustInfo + " " + jsonString); 
		})
		.fail(function() { 
			debugLog("AJAX: customerUpdate FAILED. " + _setCustInfo + " " + jsonString); 
		})
		.always(function() { 
			debugLog("AJAX: customerUpdate COMPLETED"); 
		});

		// Make sure we can't go back to the order page we're leaving now.
		myHistory.pop();
		history.replaceState({}, "CookedSpecially", initialHash);
		// deprecated in 1.4
		// $.mobile.changePage('#check', { changeHash: true });
		$.mobile.pageContainer.pagecontainer ("change", '#check', {changeHash: true});
		
		$.each(restaurants, function() {
			placeOrder(this, customerId, "DELIVERY");
		});
	}
	
	return false;
	//debugLog("DEBUG > END validateNameAddress"); 
}
/* 
 * END validateNameAddress
 **********/

/* **********
 * BEGIN validateEmailForCheck
 * 
 */
function validateEmailForCheck() {
	//console.info ("DEBUG > BEGIN validateContactInfo" );    
	var emailMatch = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$/;
	var phoneMatch = /^[0-9.-]+$/;
	var phoneClean = /[.-]/g;
	var custIdParam = "";
	
	customerEmail = $("#popupEmail input#customerEmail").val().trim().toLowerCase();
	if (customerEmail == "") {
		$("#popupEmail input#customerEmail").parent().addClass("achtung");
		return false;
	}
	
	if (emailMatch.test(customerEmail)) {
		custIdParam = customerEmail;
	}

	if (custIdParam.length != "") {
		// Make sure we can't go back to the order page we're leaving now.
		//myHistory.pop();
		//history.replaceState({}, "CookedSpecially", initialHash);
		
		$.each(restaurants, function() {
			var checkId = $("#check #restaurant" + this + " #checkId").text();
			if (checkId > 0) {
				emailCheck(custIdParam, checkId, this);
			}
    	});
    	$( "#popupEmail" ).popup( "close" );
	}
	else {
		$("#popupEmail input#customerId").parent().addClass("achtung");
	}
	return false;
	//debugLog("DEBUG > END validateEmailForCheck"); 
}
/* 
 * END validateEmailForCheck
 **********/
 
/***********
 * BEGIN populateFormsFromCustomerInfo
 */
function populateFormsFromCustomerInfo() {
    console.info('populateFormsFromCustomerInfo()');
	/*
	"customerId":25,
	"restaurantId":null,
	"userId":null,
	"firstName":null,
	"lastName":null,
	"address":null,
	"city":null,
	"phone":null,
	"email":"ewchampion@yahoo.com",
	"numberOfOrders":null,
	"createdTime":1386895735000
	*/

	if (customerInfo.firstName != null && customerInfo.lastName != null && $("input#customerName").val() == "") {
		$("input#customerName").val(customerInfo.firstName + " " + customerInfo.lastName);
	}
	if (customerInfo.address != null && $("input#customerAddress1").val() == "") {
		$("input#customerAddress1").val(customerInfo.address);
	}
	if (customerInfo.city != null && $("input#customerAddress2").val() == "") {
		$("input#customerAddress2").val(customerInfo.city);
	}

}
/* 
 * END populateFormsFromCustomerInfo
 **********/


/***********
 * BEGIN emailCheck
 */
function emailCheck(email, checkId, restaurantId) {
    console.info('emailCheck()');

	// /order/emailCheck?checkId=<checkId>&email=<target email>&restaurantId=<restaurantId>
	
    var url = _emailCheck + 
			  "checkId=" + checkId +
			  "&email=" + email +
			  "&restaurantId=" + restaurantId;
			  	
	$.ajax({
      url: url,
      dataType: 'json'
    })
    .done (function (data) {
        //$('#email-check').html('Email Sent');
		debugLog("AJAX: emailCheck() Success");
    })
    .fail(function() { 
        debugLog("AJAX: emailCheck() FAILED. " + url); 
    })
    .always(function() { 
        debugLog("AJAX: emailCheck() COMPLETED"); 
    });
}
/* 
 * END emailCheck
 **********/


/***********
 * BEGIN placeOrder
 */
function placeOrder(restaurantId, customerId, destinationType){
debugLog("DEBUG > BEGIN placeOrder(" + restaurantId +")");	
/*
{"checkId":98,"table":1,"time":"","price":815,"items":[{"id":175,"name":"Shrimp with Citrus Sala","price":325,"smallImageUrl":"/static/1/175_Shrimp-Shrimp-Salad200x200.jpg"},{"id":178,"name":"Greek Village Salad","price":245,"smallImageUrl":"/static/1/178_178_Greek_Village_Salad200x200.JPG"},{"id":178,"name":"Greek Village Salad","price":245,"smallImageUrl":"/static/1/178_178_Greek_Village_Salad200x200.JPG"}]}
*/
	var getCheckUrl = _getCheck + "restaurantId=" + restaurantId + "&custId=" + customerId;
	$.ajax({
	  url: getCheckUrl,
	  dataType: 'json'
	})
	.done (function (data) {

		var jsonOrder = JSON.parse('{"checkId":' + data.checkId + ',"cust":' + customerId + ',"time":"","price":0,"items":[]}'); // Need to set sourceType and destinationType

		$.each($("#order #order-content #restaurant" + restaurantId + " div ul li a.item"), function() {
			var itemContent = $(this).children("div.itemContent").children();
			var smallImageUrl = $(this).children("img").attr("src");
			var id = itemContent.filter("div#itemId").text();
			var name = itemContent.filter("div#title").text();
			//debugLog(itemContent.filter("div#description").text());
			var price = itemContent.filter("div.price").children("span#price").text();
			var itemType = itemContent.filter("div.itemType").text();
			var item = JSON.parse('{"id":' + id + ', "name":"' + name + '","price":' + price + ',"smallImageUrl":"' + smallImageUrl + '","dishType":"' + itemType + '"}');
			jsonOrder.price = jsonOrder.price + price;
			jsonOrder.items.push(item);
		});
		var jsonString = JSON.stringify(jsonOrder);
		
		if (jsonOrder.items.length > 0) {
			$.ajax({
				type: "POST",
				contentType:"application/json; charset=utf-8",
				url: _addToCheck,
				data: jsonString
			})
			.done (function (data) {
				// expected return: 
				//{"orderId":1,"checkId":1,"restaurantId":1,"tableId":1,"error":"Error message","status":"Failed|Success"}
				if ( data.status == "Success"){
					// Empty out the order that we submitted to get here
					$("a#order-button").addClass("ui-disabled");
					$("div#order-content div#restaurant" + restaurantId + " ul").empty();
					var theCollapsible = $("div#order-content div#restaurant" + restaurantId);
					theCollapsible.hide();

					getCheck(restaurantId, customerId, data.checkId);
		
				}else if ( data.status == "Failed"){
					alert("An Error has occurred: " + data.checkId + 
						  "\n Check Id: " + data.checkId );
				}else{
					alert("An Unknown Error has occurred.") 
				}
			})
			.fail(function() { 
				debugLog("AJAX: Add to check FAILED. " + _addToCheck + " " + jsonString); 
			})
			.always(function() { 
				debugLog("AJAX: Add to check COMPLETED"); 
			});
		}
    
		debugLog("checkId " + data.checkId); 
		debugLog("customerId " + customerId); 

	})
	.fail(function() { 
		debugLog("AJAX: getCheckPreview() FAILED. " + getCheckUrl); 
	})
	.always(function() { 
		debugLog("AJAX: getCheckPreview() COMPLETED"); 
	});

debugLog("DEBUG > END placeOrder(" + restaurantId +")");	
}
/* 
 * END placeOrder
 **********/

/***********
 * BEGIN getCheck
 */
function getCheck(restaurantId, customerId, checkId){
debugLog("DEBUG > BEGIN getCheck(" + restaurantId +")");	

	var checkDataString = "";
	var checkApi = _getCheck + "custId=" + customerId + "&restaurantId=" + restaurantId;
	$.ajax(checkApi, {
		isLocal: false
	})
	.done (function (data) {
		if( console && debugLog ) {
			debugLog("ajax success: " + checkApi);
			var checkDataString = JSON.stringify(data);
			debugLog(checkDataString);
		}
		displayCheck(restaurantId, customerId, checkId, data);
	})
	.fail(function() { 
		debugLog("ajax error: " + checkApi); 
	})
	.always(function() { 
		debugLog("ajax complete: " + checkApi); 
	});
    
debugLog("DEBUG > END getCheck(" + restaurantId +")");	
}
/* 
 * END getCheck
 **********/

/* **********
 * BEGIN displayCheck
 * Creates the home page with all the checks
    Parameters: 
 */
function displayCheck(restaurantId, customerId, checkId, data) {
	console.info("DEBUG > BEGIN displayCheck: " + checkId); 

	var checkId = data.checkId;
	var additionalChargesName1 = data.additionalChargesName1;
	var additionalChargesName2 = data.additionalChargesName2;
	var additionalChargesName3 = data.additionalChargesName3;
	var total = data.bill + data.additionalChargesValue1 + data.additionalChargesValue2 + data.additionalChargesValue3;
	var d=new Date();

	var theCheck = '' +
		'<div id="check' + checkId + '" class="ui-li ui-li-static ui-btn-up-c">' +
			'<h4 id="status" class="ui-li-desc">' +
			'	Check #<span id="checkId">' + checkId + '</span> Printed @ '+ d.toLocaleTimeString() + 

			'</h4>' +
		'</div>';
	$(theCheck).appendTo("#check-content #restaurant" + restaurantId);
	
	$.each(data.orders, function() {
		$.each(this.orderDishes, function() {
			var name = this.name;
			var quantity = this.quantity;
			var price = this.price;
			var theItem = '<strong>' + name + '</strong> ' + quantity + ' @ ' + currency + price + '<br/>';
			$(theItem).appendTo("#check-content #restaurant" + restaurantId);
		});
	});

	var theAdditions = '<br/>';
	if (additionalChargesName1 && additionalChargesName1.length > 0) {
		theAdditions = theAdditions + '<strong>' + additionalChargesName1 + ': </strong> ' + currency + data.additionalChargesValue1.toFixed(2) + '<br/>';
	}
	if (additionalChargesName2 && additionalChargesName2.length > 0) {
		theAdditions = theAdditions + '<strong>' + additionalChargesName2 + ': </strong> ' + currency + data.additionalChargesValue2.toFixed(2) + '<br/>';
	}
	if (additionalChargesName3 && additionalChargesName3.length > 0) {
		theAdditions = theAdditions + '<strong>' + additionalChargesName3 + ': </strong> ' + currency + data.additionalChargesValue3.toFixed(2) + '<br/>';
	}
	$(theAdditions).appendTo("#check-content #restaurant" + restaurantId);

	var theSummary = '<br/><strong>Total: </strong> ' + currency + total.toFixed(2) + '<br/>';
	$(theSummary).appendTo("#check-content #restaurant" + restaurantId);

	$("#check-content #restaurant" + restaurantId).show();
	setTimeout(function(){$.mobile.loading( "hide" );},1000);

	debugLog("DEBUG > END displayCheck");	
}
/* 
 * END displayCheck
 **********/
 
 
 /* 
 *******************************************************
                     DATA FUNCTIONS
 ******************************************************* 
 */
 
/***********
 * BEGIN updateAjaxDataRemote
 */
function updateAjaxDataRemote(restaurantId, restaurantName) {
debugLog("DEBUG > BEGIN updateAjaxDataRemote");    
        
		var comCookedSpeciallyMenuApi = comCookedSpeciallyApiPrefix + "/menu/getallmenusjson/" + restaurantId;
		debugLog( 'Using API: ' + comCookedSpeciallyMenuApi );

        if (navigator.onLine) {
                $.ajax(comCookedSpeciallyMenuApi, {
                        isLocal: false
                })
                .done (function (data) {
					if( console && debugLog ) {
							debugLog("ajax success: " + comCookedSpeciallyMenuApi);
							globalDataString = JSON.stringify(data);
							//debugLog(globalDataString);
					}

					globalData[restaurantId] = JSON.parse(globalDataString);
					initHomePage(restaurantId, restaurantName);

                })
                .fail(function() { 
                    debugLog("ajax error: " + comCookedSpeciallyMenuApi); 
                })
                .always(function() { 
                    debugLog("ajax complete: " + comCookedSpeciallyMenuApi); 
                });
        }
        else {
			debugLog("ajax error: offline"); 
			if (confirm(strOfflineAlert)) {
					updateAjaxDataRemote();
			}
        }
                                
//debugLog("DEBUG > END updateAjaxDataRemote");      
}
/* 
 * END updateAjaxDataRemote
 **********/

/***********
 * BEGIN updateRestaurantInfo
 */
function updateRestaurantInfo(restaurantId) {
debugLog("DEBUG > BEGIN updateRestaurantInfo");	

	orderItemCountArray[restaurantId] = 0;
	var comCookedSpeciallyRestaurantApi = comCookedSpeciallyApiPrefix + "/restaurant/getrestaurantinfo?restaurantId=" + restaurantId;
	debugLog( 'Using API: ' + comCookedSpeciallyRestaurantApi );

	$.ajax(comCookedSpeciallyRestaurantApi, {
		isLocal: false
	})
	.done (function (data) {
		if( console && debugLog ) {
			debugLog("ajax success: " + comCookedSpeciallyRestaurantApi);
			var restaurantDataString = JSON.stringify(data);
			//debugLog(restaurantDataString);
		}

		restaurantData[restaurantId] = JSON.parse(restaurantDataString);
		
		if (restaurantData[restaurantId].currency == "INR") {
			currency = 'â‚¹'; 
		}
		if (restaurantData[restaurantId].currency == "USD") {
			currency = '$';
		}
		if (restaurantData[restaurantId].country == "GBP") {
			currency = 'Â£'; 
		}
		if (restaurantData[restaurantId].country == "EUR") {
			currency = 'â‚¬'; 
		}
		if (restaurantData[restaurantId].country == "JPY") {
			restaurantData[restaurantId].country = "æ—¥æœ¬";
			currency = 'Â¥'; 
		}
		
		var theHtml = '' + 
			'<div class="restaurant-check-content" id="restaurant' + restaurantId + '" data-collapsed="false" style="display:none">' + 
			'	<h3>' + 
			'		' + restaurantData[restaurantId].businessName + 
			'	</h3>' + 
			'	<ul data-role="listview" data-inset="true"></ul>' + 
			'</div>';
		$(theHtml).appendTo("div#restaurants div#restaurants-content");
		theHtml = '' + 
			'<div class="restaurant-check-content" id="restaurant' + restaurantId + '" data-collapsed="false" style="display:none">' + 
			'	<h3>' + 
			'		' + restaurantData[restaurantId].businessName + '<span class="ui-li-count">' + currency + '0.00' + '</span>' + 
			'	</h3>' + 
			'	<ul data-role="listview" data-inset="true"></ul>' + 
			'</div>';
		$(theHtml).appendTo("div#order div#order-content");

		/*
		if (restaurantData[restaurantId].appCacheIconUrl.length > 0) {
			$("link#apple-touch-icon").attr('href', restaurantData[restaurantId].appCacheIconUrl);
		}
		if (restaurantData[restaurantId].buttonIconUrl.length > 0) {
			$("img#homeBtn").attr('src', restaurantData[restaurantId].buttonIconUrl);
		}
		*/
		if (restaurantData[restaurantId].businessLandscapeImageUrl != null && restaurantData[restaurantId].businessLandscapeImageUrl.length > 0) {
			$("div#restaurants div#restaurant" + restaurantId).css('background-image', 'url(' + restaurantData[restaurantId].businessLandscapeImageUrl + ')').css('background-size', 'cover');
		}
		if (restaurantData[restaurantId].businessName != null && restaurantData[restaurantId].businessName.length > 0) {
			$("div#restaurants div#restaurant" + restaurantId + " h3 span.ui-btn-text").text(restaurantData[restaurantId].businessName);
			//document.title = restaurantData[restaurantId].businessName;
		}
		
		var restaurantCheckHeader = '' + 
			'<div id="restaurant' + restaurantId + '" style="display:none;">' + 
			'	<h2>' + 
			'		' + restaurantData[restaurantId].businessName + 
			'	</h2>' + 
			'	<p>' + restaurantData[restaurantId].address1 + '<br/>' + restaurantData[restaurantId].address2 + '<br/>' + restaurantData[restaurantId].city + 
			'</div>';
		$(restaurantCheckHeader).appendTo("#check-content");
		
		updateAjaxDataRemote(restaurantId, restaurantData[restaurantId].businessName);
		
	})
	.fail(function() { 
		debugLog("ajax error: " + comCookedSpeciallyRestaurantApi); 
	})
	.always(function() { 
		debugLog("ajax complete: " + comCookedSpeciallyRestaurantApi); 
	});
	
debugLog("DEBUG > END updateRestaurantInfo");	
}
/* 
 * END updateRestaurantInfo
 **********/

/*
 * http://stackoverflow.com/questions/11832914/round-up-to-2-decimal-places-in-javascript
 * var n = 1.7777;    
 * n.round(2); // 1.78
 */
Number.prototype.round = function(places) {
	return +(Math.round(this + "e+" + places)  + "e-" + places);
}

/***********
 * BEGIN reset
 */
function reset(){
	$("a#done-button").addClass("ui-disabled");
	
	myHistory.pop();
	history.replaceState({}, "CookedSpecially", initialHash);
	
	if ( window.self === window.top ) { 
		//not in a frame 
		customerId = "";
		customerEmail = "";
		customerPhone = "";
		$("input#customerEmail").val("");
		$("input#customerPhone").val("");
		$("input#customerName").val("");
		$("input#customerAddress1").val("");
		$("input#customerAddress2").val("");
		try {
			FB.logout(function(response) {
				// Person is now logged out
				//$(".fb-login-button").show();
				debugLog("Facebook: Logging out.");
				debugLog(response);
			});
		} catch (error) {
			console.error("FB logout error: " + error);
		}
		alert("Thank you. Your order is complete and you have been logged out.");
		window.location.assign(initialURL);
	} 
	else {
		alert("Thank you. Your order is complete.");
		window.location.assign(initialURL);
	}
	
}
/* 
 * END reset
 **********/
 
/***********
 * BEGIN debugLog
 */
function debugLog(msg){

	if (debug) {
		console.log(msg);
	}
}
/* 
 * END debugLog
 **********/
 
 /* 
 *******************************************************
                     MAIN PROGRAM
 ******************************************************* 
 */
var startTime = new Date().getTime();

//http://stackoverflow.com/questions/13986182/how-can-i-improve-the-page-transitions-for-my-jquery-mobile-app/13986390#13986390
$(document).one("mobileinit", function () {
	$.mobile.ajaxEnabled = true;
	$.mobile.allowCrossDomainPages = true;
	$.mobile.autoInitializePage = false;
	$.mobile.defaultPageTransition = "slide";
	$.mobile.loader.prototype.options.text = "loading";
	$.mobile.loader.prototype.options.textVisible = true;
	$.mobile.mobile.touchOverflowEnabled = true;
	$.mobile.pageContainer = $("#allPages");
	$.mobile.phonegapNavigationEnabled = true;
});

// Here we run a very simple test of the Graph API after login is successful. 
function queryFB() {
	debugLog('FaceBook: Welcome!  Fetching your information.... ');
	$.mobile.loading( "show" );
	FB.api('/me', function(response) {
		debugLog('FaceBook: Good to see you, ' + response.name + '.');
		debugLog('FaceBook: Good to see you, ' + response.username + '.');
		debugLog(response);
		$("#popupContact input#customerEmail").val(response.username + "@facebook.com");
		$("#popupNameAddress input#customerName").val(response.name);
		$("#popupEmail input#customerEmail").val(response.username + "@facebook.com");
		//$(".fb-login-button").hide();
		$.mobile.loading( "hide" );
	});
}

$(document).ready(function(){
	// When the document is ready, Cordova isn't
	$.mobile.loading( "show", {
		text: "Loadingâ€¦",
		textVisible: true,
		theme: $.mobile.loader.prototype.options.theme,
		textonly: false,
		html: ""
	});
	
	$(window).on('hashchange', function() {myHistory.push(document.location.hash)});

	$.each(restaurants, function() {
		updateRestaurantInfo(this);
	});

	// Facebook
	// Use '//connect.facebook.net/en_US/all.js' for production
	// Use the Login Button Social Plugin https://developers.facebook.com/docs/reference/plugins/login/
	// By default, jQuery timestamps asynchronous requests to avoid them being cached by the browser. 
	// Youâ€™ll want to disable this functionality using the ajaxSetup() method, so that the SDK is cached locally between pages.
	$.ajaxSetup({ cache: true });
	$.getScript('//connect.facebook.net/en_UK/all/debug.js#xfbml=1&appId=362187947188195', function(){
		FB.init({
			appId	: '325767127514970',
			status	: true,					// Check Facebook Login status
			cookie	: true,					// enable cookies to allow the server to access the session
			xfbml	: true					// Look for social plugins on the page
		});     
		
		FB.Event.subscribe('xfbml.render', function(response) {
			// xfbml.render - fired when a call to FB.XFBML.parse() completes. 
			// The response parameter to the callback function is empty for this event.
		});
		// Here we subscribe to the auth.authResponseChange JavaScript event. This event is fired
		// for any authentication related change, such as login, logout or session refresh. This means that
		// whenever someone who was previously logged out tries to log in again, the correct case below 
		// will be handled. 
		FB.Event.subscribe('auth.authResponseChange', function(response) {
			// Here we specify what we do with the response anytime this event occurs. 
			if (response.status === 'connected') {
			  // The response object is returned with a status field that lets the app know the current
			  // login status of the person. In this case, we're handling the situation where they 
			  // have logged in to the app.
			  queryFB();
			} else if (response.status === 'not_authorized') {
			  // In this case, the person is logged into Facebook, but not into the app, so we call
			  // FB.login() to prompt them to do so. 
			  // In real-life usage, you wouldn't want to immediately prompt someone to login 
			  // like this, for two reasons:
			  // (1) JavaScript created popup windows are blocked by most browsers unless they 
			  // result from direct interaction from people using the app (such as a mouse click)
			  // (2) it is a bad experience to be continually prompted to login upon page load.
			  FB.login();
			} else {
			  // In this case, the person is not logged into Facebook, so we call the login() 
			  // function to prompt them to do so. Note that at this stage there is no indication
			  // of whether they are logged into the app. If they aren't then they'll see the Login
			  // dialog right after they log in to Facebook. 
			  // The same caveats as above apply to the FB.login() call here.
			  FB.login();
			}
		});
	});

});
// END: document.ready()

$( document ).on( "pageinit", function() {
	$( '#popupContact' ).on({
		popupafterclose: function() {
			$("input#customerId").parent().removeClass("achtung");
		}
	});
	$("div#order").on( "pageshow", function(event, ui) {
		updateOrderTotals();
		//Refresh the FB button state if using the XHMTL version
		//FB.XFBML.parse();
	});
	$("div#check").on( "pageshow", function(event, ui) {
		$.mobile.loading( "show" );
	});
	$("div#check").on( "pagebeforehide", function(event, ui) {
		// clear check data and reset the app
		reset();
	});
});

/* 
 * http://css-tricks.com/forums/discussion/16123/reload-jquery-functions-on-ipad-orientation-change/p1
 * http://www.ibm.com/developerworks/library/mo-jquery-mobile-api/
 */
$('body').bind('orientationchange', function(event) {
	debugLog('orientationchange: '+ event.orientation);
});

//$('body').trigger('orientationchange');

} catch (error) {
        console.error("Your javascript has an error: " + error);
}
	
</script>
</body>
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-44124437-1', 'bakedspecially.com');
	  ga('send', 'pageview');

	</script>
</html>
